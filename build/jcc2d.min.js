
/**
 * jcc2d.js
 * (c) 2014-2019 jason chen
 * Released under the MIT License.
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.JC=t.JC||{})}(this,function(t){"use strict";function e(t){return Object.prototype.toString.call(t)}function i(){this.listeners={}}function n(t,e){return 1-3*e+3*t}function s(t,e){return 3*e-6*t}function r(t){return 3*t}function o(t,e,i){return((n(e,i)*t+s(e,i))*t+r(e))*t}function h(t,e,i){return 3*n(e,i)*t*t+2*s(e,i)*t+r(e)}function a(t,e,i,n){if(!(0<=t&&t<=1&&0<=i&&i<=1))throw new Error("bezier x values must be in [0, 1] range");this.mX1=t,this.mY1=e,this.mX2=i,this.mY2=n,this.sampleValues=at?new Float32Array(ot):new Array(ot),this._preCompute()}function u(t){i.call(this),this.element=t.element||{},this.duration=t.duration||300,this.living=!0,this.resident=t.resident||!1,this.infinite=t.infinite||!1,this.alternate=t.alternate||!1,this.repeats=t.repeats||0,this.delay=t.delay||0,this.wait=t.wait||0,this.timeScale=it.isNumber(t.timeScale)?t.timeScale:1,t.onComplete&&this.on("complete",t.onComplete.bind(this)),t.onUpdate&&this.on("update",t.onUpdate.bind(this)),this.init(),this.paused=!1}function c(t){u.call(this,t),t.from=t.from||{};for(var e in t.to)it.isUndefined(t.from[e])&&(t.from[e]=this.element[e]);this.ease=t.ease||ut.Ease.InOut,this.from=t.from,this.to=t.to}function p(){}function l(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0}function f(t){u.call(this,t),t.path&&t.path instanceof p||console.warn("path is not instanceof Curve"),this.path=t.path,this.ease=t.ease||ut.Ease.InOut,this.lengthMode=!!it.isBoolean(t.lengthMode)&&t.lengthMode,this.attachTangent=!!it.isBoolean(t.attachTangent)&&t.attachTangent,this._cacheRotate=this.element.rotation;var e=this._cacheRotate;this._cacheVector=new l(10*Math.cos(e),10*Math.sin(e))}function d(t){this.points=t}function v(t,e,i){return t>=e&&t<=i}function y(t,e){for(var i=t.length-1,n=0;n<i;n++){var s=t[n];if(v(e,s.ost,s.oet))return n}}function m(t,e,i,n,s){var r=s||[i,n,t,e].join("_").replace(/\./g,"p");if(ct[r])return ct[r];var o=new a(t,e,i,n);ct[r]=o}function g(t,e,i,n){for(var s=[],r=0;r<t.length;r++){var o=(ct[i[r]]||ct[i[0]]).get(n),h=e[r]-t[r];s[r]=t[r]+h*o}return s}function w(t,e,i){var n=ct[e].get(i),s=t.getPointAt(n);return[s.x,s.y,s.z]}function x(t,e,i,n){var s=t.k;if(t.expression&&(e=t.expression.update(e)),e<=t.ost)return s[0].s;if(e>=t.oet){return s[s.length-2].e}var r=i[n],o=s[r];it.isNumber(r)&&v(e,o.ost,o.oet)||(o=s[r=i[n]=y(s,e)]);var h=(e-o.ost)/(o.oet-o.ost);return o.curve?w(o.curve,o.n,h):g(o.s,o.e,o.n,h)}function k(t,e,i){return t>e&&t<=i}function b(t){u.call(this,t),this.layer=it.copyJSON(t.layer),this.fr=t.fr||30,this.tpf=1e3/this.fr,this.iipt=this.layer.ip*this.tpf,this.iopt=this.layer.op*this.tpf,this.ip=void 0===t.ip?this.layer.ip:t.ip,this.op=void 0===t.op?this.layer.op:t.op,this.tfs=Math.floor(this.op-this.ip),this.duration=this.tfs*this.tpf,this.aks={},this.kic={},this.preParser(),this.nextPose()}function P(t,e){u.call(this,e),this.runners=[],this.queues=[],this.cursor=0,this.total=0,this.alternate=!1,t&&this.then(t)}function _(t){this.element=t,this.animates=[],this.timeScale=1,this.paused=!1}function O(t,e){if(i.call(this),e=e||{},this.type="",this.url="",this.texture=null,this.crossOrigin=e.crossOrigin,this.loaded=!1,this.hadload=!1,this.lazy=e.lazy||!1,it.isString(t))this.type=lt,this.url=t,this.texture=this.resole(),this.texture.crossOrigin=this.crossOrigin,this.lazy||this.load();else{if(!function(t){return"VIDEO"===t.tagName||"CANVAS"===t.tagName||"IMG"===t.tagName}(t))return void console.warn("texture not support this texture");this.type=ft,this.loaded=!0,this.hadload=!0,this.texture=t}this.listen()}function E(t){i.call(this),this.crossOrigin=t,this.textures={},this._total=0,this._failed=0,this._received=0}function M(t){i.call(this),this.enableFPS=!it.isBoolean(t)||t,this.pt=0,this.snippet=0,this.averageSnippet=0,this.fps=0,this.averageFps=0,this._takeTime=0,this._renderTimes=0,this.started=!1,this.paused=!1}function T(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0}function D(t,e,i,n){this.minX=it.isNumber(t)?t:1/0,this.minY=it.isNumber(e)?e:1/0,this.maxX=it.isNumber(i)?i:-1/0,this.maxY=it.isNumber(n)?n:-1/0,this.rect=null}function S(t){if(!it.isArray(t)){t=new Array(arguments.length);for(var e=0;e<t.length;++e)t[e]=arguments[e]}if(t[0]instanceof l){for(var i=[],n=0,s=t.length;n<s;n++)i.push(t[n].x,t[n].y);t=i}this.closed=!0,this.points=t}function C(t,e,i){this.x=t||0,this.y=e||0,this.radius=i||0}function I(t,e,i,n){this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0}function F(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}function A(t){this.points=t,this.passCmp={x:!0,y:!0,z:!1},this.ccmp={},this.updateCcmp()}function X(t){it.isString(t)?this.path=this.createPath(t):"path"===t.nodeName&&t.getAttribute("d")?this.path=t:console.warn('path just accept <path d="M10 10"> element or "M10 10" string but found '+t),this.totalLength=this.path.getTotalLength()}function B(t,e,i){this.degree=t,this.knots=e,this.controlPoints=i}function L(){i.call(this),this.visible=!0,this.worldAlpha=1,this.alpha=1,this.scaleX=1,this.scaleY=1,this.skewX=0,this.skewY=0,this.rotation=0,this.rotationCache=0,this._sr=0,this._cr=1,this.x=0,this.y=0,this.pivotX=0,this.pivotY=0,this.originX=0,this.originY=0,this.mask=null,this.parent=null,this.worldTransform=new F,this.passEvent=!1,this.eventArea=null,this.animation=new _(this),this.cursor="",this.interactive=!1,this.interactiveChildren=!0}function z(){L.call(this),this.childs=[],this.timeScale=1,this.paused=!1,this._zIndex=0,this.souldSort=!1,this.bounds=new D,this._bounds=new D,this.vertexData=new Float32Array(8)}function Y(t,e){i.call(this),this.element=t,this.living=!1,this.infinite=!1,this.alternate=!1,this.repeats=0,this.animations=e.animations||{},this.index=0,this.preIndex=-1,this.direction=1,this.frames=[],this.preFrame=null,this.fillMode=0,this.fps=16,this.paused=!1,this.pt=0,this.nt=0}function j(t){z.call(this),this._width=0,this._height=0,this.ready=!1,this.upTexture(t),this.movieClip=new Y(this,t)}function N(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}function V(t,e){z.call(this),e=e||{},this.mesh=t,this.meshType=it.isFunction(t)?gt:it.isObject(t)&&it.isFunction(t.render)?wt:"",""===this.meshType&&console.error("不支持的绘制对象"),this.cache=e.cache||!1,this.cached=!1,this.setBounds(e.bounds),this.frameBuffer=null}function R(t,e){z.call(this),this.text=t.toString(),this.fontStyle=e.fontStyle||"normal",this.fontWeight=e.fontWeight||"normal",this.fontSize=e.fontSize||"12px",this.fontFamily=e.fontFamily||"Arial",this.fillColor=e.fillColor||"black",this.strokeColor=e.strokeColor||"red",this.textAlign=e.textAlign||"center",this.textBaseline=e.textBaseline||"middle",this.lineWidth=it.isNumber(e.lineWidth)?e.lineWidth:1,this.stroke=!!it.isBoolean(e.stroke)&&e.stroke,this.fill=!it.isBoolean(e.fill)||e.fill}function U(){z.call(this),this.frameBuffer=new N,this.filters=[],this.needUpdateBuffer=!0,this.autoUpdateBuffer=!1,this.padding={x:0,y:0}}function W(t,e,i){(it.isNumber(t)||t<0)&&(t=0),(it.isNumber(e)||e<0)&&(e=0),(it.isNumber(i)||i<1)&&(i=1),this.blurX=0|t,this.blurY=0|e,this.quality=0|i}function q(){z.call(this)}function G(t){var e=this;this.canvas=it.isString(t.dom)?document.getElementById(t.dom)||document.querySelector(t.dom):t.dom,this.realWidth=t.width||this.canvas.width,this.realHeight=t.height||this.canvas.height,this.ctx=this.canvas.getContext("2d"),this.canvas.style.backgroundColor=t.backgroundColor||"transparent",this.autoClear=!0,this.autoStyle=!1,this.rootMatrix=new F,this._resolution=0,this.resolution=t.resolution||1,this.width=this.canvas.width=this.realWidth*this.resolution,this.height=this.canvas.height=this.realHeight*this.resolution,this.interactionManager=new Ft(this),this._enableinteractive=null;var i=function(t){e.interactionManager.update(t)};this.interactiveOnChange=function(){this.enableinteractive?(this.on("prerender",i),this.interactionManager.addEvents()):(this.off("prerender",i),this.interactionManager.removeEvents())},this.enableinteractive=!it.isBoolean(t.interactive)||t.interactive,this.currentScene=null}function H(t){var e=this;this.renderer=new G(t),this.scene=new q,this.ticker=new M(t.enableFPS),this.ticker.on("tick",function(t){e.update(t)}),this.ticker.start()}function K(t,e){var i=e.v[0];t.moveTo(i[0],i[1]);for(var n=e.v.length,s=1,r=i;s<n;s++){var o=e.o[s-1],h=e.i[s],a=e.v[s];t.bezierCurveTo(r[0]+o[0],r[1]+o[1],a[0]+h[0],a[1]+h[1],a[0],a[1]),r=a}var u=e.o[s-1],c=e.i[0],p=e.v[0];t.bezierCurveTo(r[0]+u[0],r[1]+u[1],p[0]+c[0],p[1]+c[1],p[0],p[1])}function J(t,e){t.moveTo(0,0),t.lineTo(e.w,0),t.lineTo(e.w,e.h),t.lineTo(0,e.h),t.lineTo(0,0)}function $(t,e){var i=null;switch(t.ty){case"sh":i=new zt(t,e)}return i}function Q(t,e){return(t=t.slice(0,3)).map(function(t){return 255*t>>0})}function Z(t,e){return 2.55*t[0]>>0}function tt(t,e){return t[e]}function et(t){var e=t.match(Ut),i=function(t){return t.split(/\s*,\s*/).map(function(t){return Wt.test(t)?t.replace(/"|'/g,""):parseInt(t)})}(e[2]);return{name:e[1],mode:i[0],offset:i[1]}}!function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),s=window.setTimeout(function(){e(i+n)},n);return t=i+n,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),window.RAF=window.requestAnimationFrame,window.CAF=window.cancelAnimationFrame}();var it={copyJSON:function(t){return JSON.parse(JSON.stringify(t))},DTR:function(t){return t*Math.PI/180},RTD:function(t){return 180*t/Math.PI},isArray:function(){var t=e([]);return function(i){return e(i)===t}}(),isObject:function(){var t=e({});return function(i){return e(i)===t}}(),isString:function(){var t=e("s");return function(i){return e(i)===t}}(),isNumber:function(){var t=e(1);return function(i){return e(i)===t}}(),isFunction:function(){var t=e(function(){});return function(i){return e(i)===t}}(),isUndefined:function(t){return void 0===t},isBoolean:function(){var t=e(!0);return function(i){return e(i)===t}}(),random:function(t,e){return this.isArray(t)?t[~~(Math.random()*t.length)]:(this.isNumber(e)||(e=t||1,t=0),t+Math.random()*(e-t))},euclideanModulo:function(t,e){return(t%e+e)%e},codomainBounce:function(t,e,i){return t<e?2*e-t:t>i?2*i-t:t},clamp:function(t,e,i){return t<e?e:t>i?i:t},linear:function(t,e,i){return t<=e?0:t>=i?1:t=(t-e)/(i-e)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)}};i.prototype.on=function(t,e){if(it.isFunction(e))return this.interactive=!0,this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e),this},i.prototype.off=function(t,e){if(!it.isUndefined(this.listeners[t])){var i=this.listeners[t]||[],n=i.length;if(n>0)if(e)for(;n--;)i[n]===e&&i.splice(n,1);else i.length=0;return this}},i.prototype.once=function(t,e){if(it.isFunction(e)){var i=this;return this.on(t,function n(s){e&&e(s),i.off(t,n)}),this}},i.prototype.emit=function(t){if(!it.isUndefined(this.listeners[t])){for(var e=(this.listeners[t]||[]).slice(0),i=[],n=1;n<arguments.length;n++)i.push(arguments[n]);var s=void 0;for(s=0;s<e.length;s++)e[s].apply(this,i)}};var nt=4,st=1e-7,rt=10,ot=11,ht=1/(ot-1),at="function"==typeof Float32Array;a.prototype._preCompute=function(){if(this.mX1!==this.mY1||this.mX2!==this.mY2)for(var t=0;t<ot;++t)this.sampleValues[t]=o(t*ht,this.mX1,this.mX2)},a.prototype._getTForX=function(t){for(var e=0,i=1,n=ot-1;i!==n&&this.sampleValues[i]<=t;++i)e+=ht;--i;var s=e+(t-this.sampleValues[i])/(this.sampleValues[i+1]-this.sampleValues[i])*ht,r=h(s,this.mX1,this.mX2);return r>=.001?function(t,e,i,n){for(var s=0;s<nt;++s){var r=h(e,i,n);if(0===r)return e;e-=(o(e,i,n)-t)/r}return e}(t,s,this.mX1,this.mX2):0===r?s:function(t,e,i,n,s){var r=void 0,h=void 0,a=0;do{(r=o(h=e+(i-e)/2,n,s)-t)>0?i=h:e=h}while(Math.abs(r)>st&&++a<rt);return h}(t,e,e+ht,this.mX1,this.mX2)},a.prototype.get=function(t){return this.mX1===this.mY1&&this.mX2===this.mY2?t:0===t?0:1===t?1:o(this._getTForX(t),this.mY1,this.mY2)};var ut={Linear:{None:function(t){return t}},Ease:{In:function(){var t=new a(.42,0,1,1);return function(e){return t.get(e)}}(),Out:function(){var t=new a(0,0,.58,1);return function(e){return t.get(e)}}(),InOut:function(){var t=new a(.42,0,.58,1);return function(e){return t.get(e)}}(),Bezier:function(t,e,i,n){var s=new a(t,e,i,n);return function(t){return s.get(t)}}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-ut.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*ut.Bounce.In(2*t):.5*ut.Bounce.Out(2*t-1)+.5}}};(u.prototype=Object.create(i.prototype)).update=function(t){var e=this.direction*this.timeScale*t;if(this.waitCut>0)this.waitCut-=Math.abs(e);else{if(!(this.paused||!this.living||this.delayCut>0)){this.progress+=e;var i=!1,n=this.progress;this.spill()&&(this.repeatsCut>0||this.infinite?(this.repeatsCut>0&&--this.repeatsCut,this.delayCut=this.delay,this.alternate?(this.direction*=-1,this.progress=it.codomainBounce(this.progress,0,this.duration)):(this.direction=1,this.progress=it.euclideanModulo(this.progress,this.duration))):i=!0);var s=void 0;return i?(this.resident||(this.living=!1),this.progress=it.clamp(n,0,this.duration),s=this.nextPose(),this.emit("complete",s,Math.abs(n-this.progress))):(s=this.nextPose(),this.emit("update",s,this.progress/this.duration)),s}this.delayCut>0&&(this.delayCut-=Math.abs(e))}},u.prototype.spill=function(){var t=this.progress<=0&&-1===this.direction,e=this.progress>=this.duration&&1===this.direction;return t||e},u.prototype.init=function(){this.direction=1,this.progress=0,this.repeatsCut=this.repeats,this.delayCut=this.delay,this.waitCut=this.wait},u.prototype.nextPose=function(){console.warn("should be overwrite")},u.prototype.linear=function(t,e,i){return(e-t)*i+t},u.prototype.pause=function(){this.paused=!0},u.prototype.restart=function(){this.paused=!1},u.prototype.stop=function(){this.repeats=0,this.infinite=!1,this.progress=this.duration},u.prototype.setSpeed=function(t){this.timeScale=t},u.prototype.cancle=function(){this.living=!1},(c.prototype=Object.create(u.prototype)).nextPose=function(){var t={},e=this.ease(this.progress/this.duration);for(var i in this.to)t[i]=this.linear(this.from[i],this.to[i],e),void 0!==this.element[i]&&(this.element[i]=t[i]);return t},p.prototype={constructor:p,getPoint:function(t){return console.warn("Curve: Warning, getPoint() not implemented!",t),null},getPointAt:function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},getPoints:function(t){isNaN(t)&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return e},getSpacedPoints:function(t){isNaN(t)&&(t=5);for(var e=[],i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(isNaN(t)&&(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e=[],i=void 0,n=this.getPoint(0),s=void 0,r=0;for(e.push(0),s=1;s<=t;s++)r+=(i=this.getPoint(s/t)).distanceTo(n),e.push(r),n=i;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var i=this.getLengths(),n=0,s=i.length,r=void 0;r=e||t*i[s-1];for(var o=0,h=s-1,a=void 0;o<=h;)if(n=Math.floor(o+(h-o)/2),(a=i[n]-r)<0)o=n+1;else{if(!(a>0)){h=n;break}h=n-1}if(n=h,i[n]===r)return n/(s-1);var u=i[n];return(n+(r-u)/(i[n+1]-u))/(s-1)},getTangent:function(t){var e=t-1e-4,i=t+1e-4,n=this.getPoint(e);return this.getPoint(i).clone().sub(n).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)}},l.prototype.clone=function(){return new l(this.x,this.y,this.z,this.w)},l.prototype.copy=function(t){this.set(t.x,t.y,t.z,t.w)},l.prototype.set=function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},l.prototype.add=function(t,e){return void 0!==e?(console.warn("Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},l.prototype.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},l.prototype.sub=function(t,e){return void 0!==e?(console.warn("Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},l.prototype.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},l.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},l.prototype.length=function(){return Math.sqrt(this.lengthSq())},l.prototype.normalize=function(){return this.divideScalar(this.length())},l.prototype.divideScalar=function(t){return this.multiplyScalar(1/t)},l.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},l.prototype.distanceToSquared=function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},l.prototype.multiplyScalar=function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t,this.w*=t):(this.x=0,this.y=0,this.z=0,this.w=0),this},l.prototype.cross=function(t,e){if(void 0!==e)return console.warn("Use .crossVectors( a, b ) instead."),this.crossVectors(t,e);var i=this.x,n=this.y,s=this.z;return this.x=n*t.z-s*t.y,this.y=s*t.x-i*t.z,this.z=i*t.y-n*t.x,this},l.prototype.crossVectors=function(t,e){var i=t.x,n=t.y,s=t.z,r=e.x,o=e.y,h=e.z;return this.x=n*h-s*o,this.y=s*r-i*h,this.z=i*o-n*r,this},(f.prototype=Object.create(u.prototype)).nextPose=function(){var t=0,e=this.ease(this.progress/this.duration),i=(this.lengthMode?this.path.getPointAt(e):this.path.getPoint(e)).clone();return this.attachTangent&&(t=this.decomposeRotate(e),i.rotation=!1===t?this.preDegree:t,i.rotation+=this._cacheRotate,!1!==t&&(this.preDegree=t)),this.element.setProps(i),i},f.prototype.decomposeRotate=function(t){var e=this.lengthMode?this.path.getTangentAt(t):this.path.getTangent(t),i=this._cacheVector.x*e.y-e.x*this._cacheVector.y>0?1:-1,n=(e.x*this._cacheVector.x+e.y*this._cacheVector.y)/(Math.sqrt(e.x*e.x+e.y*e.y)*Math.sqrt(this._cacheVector.x*this._cacheVector.x+this._cacheVector.y*this._cacheVector.y));return!isNaN(n)&&i*Math.acos(n)*it.RTD},(d.prototype=Object.create(p.prototype)).getPoint=function(t,e){var i=e||this.points,n=i.length,s=1-t,r=i.slice(0,n-1),o=i.slice(1),h=new l;if(n>3){var a=this.getPoint(t,r),u=this.getPoint(t,o);return h.x=s*a.x+t*u.x,h.y=s*a.y+t*u.y,h}return h.x=s*s*i[0].x+2*t*s*i[1].x+t*t*i[2].x,h.y=s*s*i[0].y+2*t*s*i[1].y+t*t*i[2].y,h};var ct={},pt={o:{props:["alpha"],scale:.01},r:{props:["rotation"],scale:1},p:{props:["x","y"],scale:1},a:{props:["pivotX","pivotY"],scale:1},s:{props:["scaleX","scaleY"],scale:.01}};(b.prototype=Object.create(u.prototype)).preParser=function(){var t=this.layer.ks;for(var e in t)t[e].a?this.parserDynamic(e):this.parserStatic(e)},b.prototype.parserDynamic=function(t){var e=this.layer.ks[t],i=e.k;e.jcst=i[0].t*this.tpf,e.jcet=i[i.length-1].t*this.tpf;for(var n=0;n<i.length;n++){var s=i[n],r=i[n+1];if(r)if(s.jcst=s.t*this.tpf,s.jcet=r.t*this.tpf,it.isString(s.n)&&s.ti&&s.to){m(s.o.x,s.o.y,s.i.x,s.i.y);var o=new l(s.s[0],s.s[1]),h=new l(s.e[0],s.e[1]),a=new l(s.s[0]+s.ti[0],s.s[1]+s.ti[1]),u=new l(s.e[0]+s.to[0],s.e[1]+s.to[1]);s.curve=new d([o,a,u,h])}else for(var c=0;c<s.n.length;c++)m(s.o.x[c],s.o.y[c],s.i.x[c],s.i.y[c])}this.aks[t]=e},b.prototype.parserStatic=function(t){var e=this.layer.ks[t].k;it.isNumber(e)&&(e=[e]),this.setValue(t,e)},b.prototype.nextPose=function(){var t={};for(var e in this.aks){var i=this.aks[e];t[e]=this.interpolation(e,i),this.setValue(e,t[e])}return t},b.prototype.interpolation=function(t,e){var i=e.k,n=it.clamp(this.progress,0,e.jcet),s=e.jcst,r=e.jcet,o=n<this.iipt;if(o===this.element.visible&&(this.element.visible=!o),n<=s)return i[0].s;if(n>=r){return i[i.length-2].e}var h=this.kic[t];it.isNumber(h)&&k(n,i[h].jcst,i[h].jcet)||(h=this.kic[t]=function(t,e){for(var i=t.length-1,n=0;n<i;n++){var s=t[n];if(k(e,s.jcst,s.jcet))return n}}(i,n));var a=i[h],u=(n-a.jcst)/(a.jcet-a.jcst);return a.curve?w(a.curve,a.n,u):g(a.s,a.e,a.n,u)},b.prototype.setValue=function(t,e){for(var i=pt[t].props,n=pt[t].scale,s=0;s<i.length;s++){var r=e[s];this.element[i[s]]=n*r}},(P.prototype=Object.create(u.prototype)).then=function(t){return this.queues.push(t),this.total=this.queues.length,this},P.prototype.nextOne=function(t,e){this.runners[this.cursor].init(),this.cursor++,this.timeSnippet=e},P.prototype.initOne=function(){var t=this.queues[this.cursor];t.infinite=!1,t.resident=!0,t.element=this.element;var e=null;t.path?e=new f(t):t.to&&(e=new c(t)),null!==e&&(e.on("complete",this.nextOne.bind(this)),this.runners.push(e))},P.prototype.nextPose=function(t){return!this.runners[this.cursor]&&this.queues[this.cursor]&&this.initOne(),this.timeSnippet>0&&(t+=this.timeSnippet,this.timeSnippet=0),this.runners[this.cursor].update(t)},P.prototype.update=function(t){if(this.wait>0)this.wait-=Math.abs(t);else{if(!(this.paused||!this.living||this.delayCut>0)){var e=this.cursor,i=this.nextPose(this.timeScale*t);return this.emit("update",{index:e,pose:i},this.progress/this.duration),this.spill()&&(this.repeats>0||this.infinite?(this.repeats>0&&--this.repeats,this.delayCut=this.delay,this.cursor=0):(this.resident||(this.living=!1),this.emit("complete",i))),i}this.delayCut>0&&(this.delayCut-=Math.abs(t))}},P.prototype.spill=function(){return this.cursor>=this.total},_.prototype.update=function(t){if(!this.paused){t=this.timeScale*t;for(var e=this.animates.slice(0),i=0;i<e.length;i++)e[i].living||e[i].resident||this.animates.splice(i,1),e[i].update(t)}},_.prototype.animate=function(t,e){return t.element=this.element,this._addMove(new c(t),e)},_.prototype.motion=function(t,e){return t.element=this.element,this._addMove(new f(t),e)},_.prototype.queues=function(t,e,i){return e.element=this.element,this._addMove(new P(t,e),i)},_.prototype.keyFrames=function(t,e){return t.element=this.element,this._addMove(new b(t),e)},_.prototype._addMove=function(t,e){return e&&this.clear(),this.animates.push(t),t},_.prototype.pause=function(){this.paused=!0},_.prototype.restart=function(){this.paused=!1},_.prototype.setSpeed=function(t){this.timeScale=t},_.prototype.clear=function(){this.animates.length=0};var lt="url",ft="img";(O.prototype=Object.create(i.prototype)).resole=function(){return new Image},O.prototype.load=function(t){this.hadload||this.type!==lt||(t=t||this.url,this.hadload=!0,this.texture.src=t)},O.prototype.listen=function(){var t=this;this.texture.addEventListener("load",function(){t.loaded=!0,t.emit("load")}),this.texture.addEventListener("error",function(){t.emit("error")})},Object.defineProperty(O.prototype,"width",{get:function(){return this.texture?this.texture.width:0}}),Object.defineProperty(O.prototype,"height",{get:function(){return this.texture?this.texture.height:0}}),Object.defineProperty(O.prototype,"naturalWidth",{get:function(){return this.texture?this.texture.naturalWidth:0}}),Object.defineProperty(O.prototype,"naturalHeight",{get:function(){return this.texture?this.texture.naturalHeight:0}}),(E.prototype=Object.create(i.prototype)).load=function(t){var e=this;this._total=0,this._failed=0,this._received=0;for(var i in t)this._total++,this.textures[i]=new O(t[i],{crossOrigin:this.crossOrigin}),function(t){t.on("load",function(){e._received++,e.emit("update"),e._received+e._failed>=e._total&&e.emit("complete")}),t.on("error",function(){e._failed++,e.emit("update"),e._received+e._failed>=e._total&&e.emit("complete")})}(this.textures[i]);return this},E.prototype.getById=function(t){return this.textures[t]},Object.defineProperty(E.prototype,"progress",{get:function(){return 0===this._total?1:(this._received+this._failed)/this._total}});var dt=function(t,e){return new E(e).load(t)};(M.prototype=Object.create(i.prototype)).timeline=function(){this.snippet=Date.now()-this.pt,(0===this.pt||this.snippet>200)&&(this.pt=Date.now(),this.snippet=Date.now()-this.pt),this.enableFPS&&(this._renderTimes++,this._takeTime+=Math.max(15,this.snippet),this.fps=1e3/Math.max(15,this.snippet)>>0,this.averageFps=1e3/(this._takeTime/this._renderTimes)>>0),this.pt+=this.snippet},M.prototype.tick=function(){this.paused||(this.timeline(),this.emit("update",this.snippet),this.emit("tick",this.snippet))},M.prototype.start=function(){var t=this;if(!this.started){this.started=!0;!function e(){t.tick(),t.loop=RAF(e)}()}},M.prototype.stop=function(){CAF(this.loop),this.started=!1},M.prototype.pause=function(){this.paused=!0},M.prototype.resume=function(){this.paused=!1},T.EMPTY=new T(0,0,0,0),T.prototype.clone=function(){return new T(this.x,this.y,this.width,this.height)},T.prototype.contains=function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)},D.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},D.prototype.clear=function(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this},D.prototype.getRectangle=function(t){return this.isEmpty()?T.EMPTY:(t=t||new T(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},D.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},D.prototype.addRect=function(t){this.minX=t.x,this.maxX=t.width+t.x,this.minY=t.y,this.maxY=t.height+t.y},D.prototype.addVert=function(t){for(var e=this.minX,i=this.minY,n=this.maxX,s=this.maxY,r=0;r<t.length;r+=2){var o=t[r],h=t[r+1];e=o<e?o:e,i=h<i?h:i,n=o>n?o:n,s=h>s?h:s}this.minX=e,this.minY=i,this.maxX=n,this.maxY=s},D.prototype.addBounds=function(t){var e=this.minX,i=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s},S.prototype.clone=function(){return new S(this.points.slice())},S.prototype.contains=function(t,e){for(var i=!1,n=this.points.length/2,s=0,r=n-1;s<n;r=s++){var o=this.points[2*s],h=this.points[2*s+1],a=this.points[2*r],u=this.points[2*r+1];h>e!=u>e&&t<(a-o)*(e-h)/(u-h)+o&&(i=!i)}return i},C.prototype.clone=function(){return new C(this.x,this.y,this.radius)},C.prototype.contains=function(t,e){if(this.radius<=0)return!1;var i=this.x-t,n=this.y-e;return i*=i,n*=n,i+n<=this.radius*this.radius},C.prototype.getBounds=function(){return new T(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},I.prototype.clone=function(){return new I(this.x,this.y,this.width,this.height)},I.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width,n=(e-this.y)/this.height;return i*=i,n*=n,i+n<=1},I.prototype.getBounds=function(){return new T(this.x-this.width,this.y-this.height,this.width,this.height)},F.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},F.prototype.toArray=function(t){this.array||(this.array=new Float32Array(9));var e=this.array;return t?(e[0]=this.a,e[1]=this.b,e[2]=0,e[3]=this.c,e[4]=this.d,e[5]=0,e[6]=this.tx,e[7]=this.ty,e[8]=1):(e[0]=this.a,e[1]=this.c,e[2]=this.tx,e[3]=this.b,e[4]=this.d,e[5]=this.ty,e[6]=0,e[7]=0,e[8]=1),e},F.prototype.apply=function(t,e){return e=e||{},e.x=this.a*t.x+this.c*t.y+this.tx,e.y=this.b*t.x+this.d*t.y+this.ty,e},F.prototype.applyInverse=function(t,e){var i=1/(this.a*this.d+this.c*-this.b);return e.x=this.d*i*t.x+-this.c*i*t.y+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*t.y+-this.b*i*t.x+(-this.ty*this.a+this.tx*this.b)*i,e},F.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},F.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},F.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,s=this.c,r=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=s*e-this.d*i,this.d=s*i+this.d*e,this.tx=r*e-this.ty*i,this.ty=r*i+this.ty*e,this},F.prototype.append=function(t){var e=this.a,i=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this},F.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},F.prototype.setTransform=function(t,e,i,n,s,r,o,h,a,u,c){var p=Math.sin(o),l=Math.cos(o),f=Math.tan(a),d=Math.tan(h),v=l*s,y=p*s,m=-p*r,g=l*r,w=i+u,x=n+c;return this.a=v+f*m,this.b=y+f*g,this.c=d*v+m,this.d=d*y+g,this.tx=t-w*this.a-x*this.c+u,this.ty=e-w*this.b-x*this.d+c,this};var vt=new F,yt=new F;(A.prototype=Object.create(p.prototype)).updateCcmp=function(){for(var t=0;t<this.points.length;t++){var e=this.points[t];for(var i in this.passCmp)this.passCmp[i]&&!it.isUndefined(e[i])&&(this.ccmp[i]=this.ccmp[i]||[],this.ccmp[i][t]=e[i])}},A.prototype.getPoint=function(t){var e=new l;for(var i in this.passCmp)this.passCmp[i]&&(e[i]=this.solveEachCmp(this.ccmp[i],t));return e},A.prototype.solveEachCmp=function(t,e){var i=t.length-1,n=i*e,s=Math.floor(n),r=this.solve;return t[0]===t[i]?(e<0&&(s=Math.floor(n=i*(1+e))),r(t[(s-1+i)%i],t[s],t[(s+1)%i],t[(s+2)%i],n-s)):e<0?t[0]-(r(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[i]-(r(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):r(t[s?s-1:0],t[s],t[i<s+1?i:s+1],t[i<s+2?i:s+2],n-s)},A.prototype.solve=function(t,e,i,n,s){var r=.5*(i-t),o=.5*(n-e),h=s*s;return(2*e-2*i+r+o)*(s*h)+(-3*e+3*i-2*r-o)*h+r*s+e},(X.prototype=Object.create(p.prototype)).createPath=function(t){return document.createElementNS("http://www.w3.org/2000/svg","path").setAttribute(t)},X.prototype.getPoint=function(t){var e=this.path.getPointAtLength(t*this.totalLength);return new l(e.x,e.y)};var mt={findSpan:function(t,e,i){var n=i.length-t-1;if(e>=i[n])return n-1;if(e<=i[t])return t;for(var s=t,r=n,o=Math.floor((s+r)/2);e<i[o]||e>=i[o+1];)e<i[o]?r=o:s=o,o=Math.floor((s+r)/2);return o},calcBasisFunctions:function(t,e,i,n){var s=[],r=[],o=[];s[0]=1;for(var h=1;h<=i;++h){r[h]=e-n[t+1-h],o[h]=n[t+h]-e;for(var a=0,u=0;u<h;++u){var c=o[u+1],p=r[h-u],l=s[u]/(c+p);s[u]=a+c*l,a=p*l}s[h]=a}return s},calcBSplinePoint:function(t,e,i,n){for(var s=this.findSpan(t,n,e),r=this.calcBasisFunctions(s,n,t,e),o=new l(0,0,0,0),h=0;h<=t;++h){var a=i[s-t+h],u=r[h],c=a.w*u;o.x+=a.x*c,o.y+=a.y*c,o.z+=a.z*c,o.w+=a.w*u}return o},calcBasisFunctionDerivatives:function(t,e,i,n,s){var r=[],o=0;for(o=0;o<=i;++o)r[o]=0;var h=[];for(o=0;o<=n;++o)h[o]=r.slice(0);var a=[];for(o=0;o<=i;++o)a[o]=r.slice(0);a[0][0]=1;var u=r.slice(0),c=r.slice(0),p=1,l=0,f=1;for(p=1;p<=i;++p){u[p]=e-s[t+1-p],c[p]=s[t+p]-e;var d=0;for(l=0;l<p;++l){var v=c[l+1],y=u[p-l];a[p][l]=v+y;var m=a[l][p-1]/a[p][l];a[l][p]=d+v*m,d=y*m}a[p][p]=d}for(p=0;p<=i;++p)h[0][p]=a[p][i];for(l=0;l<=i;++l){var g=0,w=1,x=[];for(o=0;o<=i;++o)x[o]=r.slice(0);for(x[0][0]=1,f=1;f<=n;++f){var k=0,b=l-f,P=i-f;l>=f&&(x[w][0]=x[g][0]/a[P+1][b],k=x[w][0]*a[b][P]);var _=l-1<=P?f-1:i-l;for(p=b>=-1?1:-b;p<=_;++p)x[w][p]=(x[g][p]-x[g][p-1])/a[P+1][b+p],k+=x[w][p]*a[b+p][P];l<=P&&(x[w][f]=-x[g][f-1]/a[P+1][l],k+=x[w][f]*a[l][P]),h[f][l]=k,p=g,g=w,w=p}}for(l=i,f=1;f<=n;++f){for(p=0;p<=i;++p)h[f][p]*=l;l*=i-f}return h},calcBSplineDerivatives:function(t,e,i,n,s){for(var r=s<t?s:t,o=[],h=this.findSpan(t,n,e),a=this.calcBasisFunctionDerivatives(h,n,t,r,e),u=[],c=void 0,p=0,f=0;p<i.length;++p){var d=(c=i[p].clone()).w;c.x*=d,c.y*=d,c.z*=d,u[p]=c}for(;f<=r;++f){c=u[h-t].clone().multiplyScalar(a[f][0]);for(var v=1;v<=t;++v)c.add(u[h-t+v].clone().multiplyScalar(a[f][v]));o[f]=c}for(f=r+1;f<=s+1;++f)o[f]=new l(0,0,0);return o},calcKoverI:function(t,e){var i=1,n=2;for(n=2;n<=t;++n)i*=n;var s=1;for(n=2;n<=e;++n)s*=n;for(n=2;n<=t-e;++n)s*=n;return i/s},calcRationalCurveDerivatives:function(t){var e=t.length,i=[],n=[],s=0;for(s=0;s<e;++s){var r=t[s];i[s]=new l(r.x,r.y,r.z),n[s]=r.w}for(var o=[],h=0;h<e;++h){var a=i[h].clone();for(s=1;s<=h;++s)a.sub(o[h-s].clone().multiplyScalar(this.calcKoverI(h,s)*n[s]));o[h]=a.divideScalar(n[0])}return o},calcNURBSDerivatives:function(t,e,i,n,s){var r=this.calcBSplineDerivatives(t,e,i,n,s);return this.calcRationalCurveDerivatives(r)},calcSurfacePoint:function(t,e,i,n,s,r,o){for(var h=this.findSpan(t,r,i),a=this.findSpan(e,o,n),u=this.calcBasisFunctions(h,r,t,i),c=this.calcBasisFunctions(a,o,e,n),p=[],f=0;f<=e;++f){p[f]=new l(0,0,0,0);for(var d=0;d<=t;++d){var v=s[h-t+d][a-e+f].clone(),y=v.w;v.x*=y,v.y*=y,v.z*=y,p[f].add(v.multiplyScalar(u[d]))}}var m=new l(0,0,0,0);for(f=0;f<=e;++f)m.add(p[f].multiplyScalar(c[f]));return m.divideScalar(m.w),new l(m.x,m.y,m.z)}};(B.prototype=Object.create(p.prototype)).constructor=B,B.prototype.getPoint=function(t){var e=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),i=mt.calcBSplinePoint(this.degree,this.knots,this.controlPoints,e);return 1!==i.w&&i.divideScalar(i.w),new l(i.x,i.y,i.z)},B.prototype.getTangent=function(t){var e=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),i=mt.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,e,1)[1].clone();return i.normalize(),i},L.prototype=Object.create(i.prototype),Object.defineProperty(L.prototype,"scale",{get:function(){return this.scaleX},set:function(t){this.scaleX=this.scaleY=t}}),Object.defineProperty(L.prototype,"trackedPointers",{get:function(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers}}),L.prototype.animate=function(t,e){return this.animation.animate(t,e)},L.prototype.motion=function(t,e){return this.animation.motion(t,e)},L.prototype.keyFrames=function(t,e){return this.animation.keyFrames(t,e)},L.prototype.runners=function(t,e){return this.animation.runners(t,e)},L.prototype.queues=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments[2];return this.animation.queues(t,e,i)},L.prototype.isVisible=function(){return!!(this.visible&&this.alpha>0&&this.scaleX*this.scaleY!=0)},L.prototype.removeMask=function(){this.mask=null},L.prototype.setProps=function(t){if(void 0!==t)for(var e in t)void 0!==this[e]&&(this[e]=t[e])},L.prototype.updateTransform=function(t){var e=t||this.parent&&this.parent.worldTransform||vt,i=this.worldTransform,n=this.parent&&this.parent.worldAlpha||1,s=void 0,r=void 0,o=void 0,h=void 0,a=void 0,u=void 0,c=this.pivotX+this.originX,p=this.pivotY+this.originY;this.skewX||this.skewY?(yt.setTransform(this.x,this.y,this.pivotX,this.pivotY,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,this.originX,this.originY),i.a=yt.a*e.a+yt.b*e.c,i.b=yt.a*e.b+yt.b*e.d,i.c=yt.c*e.a+yt.d*e.c,i.d=yt.c*e.b+yt.d*e.d,i.tx=yt.tx*e.a+yt.ty*e.c+e.tx,i.ty=yt.tx*e.b+yt.ty*e.d+e.ty):this.rotation%360?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),s=this._cr*this.scaleX,r=this._sr*this.scaleX,o=-this._sr*this.scaleY,h=this._cr*this.scaleY,a=this.x,u=this.y,(this.pivotX||this.pivotY||this.originX||this.originY)&&(a-=c*s+p*o-this.originX,u-=c*r+p*h-this.originY),i.a=s*e.a+r*e.c,i.b=s*e.b+r*e.d,i.c=o*e.a+h*e.c,i.d=o*e.b+h*e.d,i.tx=a*e.a+u*e.c+e.tx,i.ty=a*e.b+u*e.d+e.ty):(s=this.scaleX,h=this.scaleY,a=this.x-c*s+this.originX,u=this.y-p*h+this.originY,i.a=s*e.a,i.b=s*e.b,i.c=h*e.c,i.d=h*e.d,i.tx=a*e.a+u*e.c+e.tx,i.ty=a*e.b+u*e.d+e.ty),this.worldAlpha=this.alpha*n},L.prototype.updateAnimation=function(t){this.animation.update(t)},L.prototype.setTransform=function(t){var e=this.worldTransform;t.globalAlpha=this.worldAlpha,t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty)},L.prototype.getGlobalPos=function(){return{x:this.worldTransform.tx,y:this.worldTransform.ty}},L.prototype.setArea=function(t,e){null!==this.eventArea&&this.eventArea.clocked&&!e||(this.eventArea=t,e&&(this.eventArea.clocked=!0))},L.prototype.contains=function(t){if(null===this.eventArea)return!1;var e=new l;return this.worldTransform.applyInverse(t,e),this.eventArea&&this.eventArea.contains(e.x,e.y)},z.prototype=Object.create(L.prototype),Object.defineProperty(z.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.souldSort=!0))}}),z.prototype._sortList=function(){var t=this.childs,e=t.length,i=void 0,n=void 0,s=void 0;for(i=0;i<e-1;i++)for(n=0;n<e-1-i;n++)t[n].zIndex>t[n+1].zIndex&&(s=t[n],t[n]=t[n+1],t[n+1]=s);this.souldSort=!1},z.prototype.updateMovin=function(t,e){for(var i=this.childs.length,n=0;n<i;n++){var s=this.childs[n];s&&!s._aniRoot&&s.updateMovin&&s.updateMovin(t,e)}this.updateKeyframes&&this.updateKeyframes(t,e)},z.prototype.adds=function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.adds(arguments[e]);return this}return t===this&&console.error("adds: object can't be added as a child of itself.",t),t&&t instanceof z?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.childs.push(t),this.souldSort=!0):console.error("adds: object not an instance of Container",t),this},z.prototype.remove=function(t){if(arguments.length>1)for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);var i=this.childs.indexOf(t);-1!==i&&(t.parent=null,this.childs.splice(i,1))},z.prototype.updateTimeline=function(t){if(this.emit("pretimeline",t),!this.paused){t=this.timeScale*t,this.updateAnimation(t);for(var e=0,i=this.childs.length;e<i;){this.childs[e].updateTimeline(t),e++}this.emit("posttimeline",t)}},z.prototype.updatePosture=function(){this.emit("preposture"),this.souldSort&&this._sortList(),this.updateTransform();for(var t=0,e=this.childs.length;t<e;){this.childs[t].updatePosture(),t++}this.emit("postposture")},z.prototype.render=function(t){this.emit("prerender"),t.save(),this.setTransform(t),this.mask&&this.mask.render(t),this.renderMe(t);for(var e=0,i=this.childs.length;e<i;){var n=this.childs[e];e++,n.isVisible()&&n.render(t)}t.restore(),this.emit("postrender")},z.prototype.renderMe=function(){return!0},z.prototype.calculateVertices=function(){var t=this.worldTransform,e=t.a,i=t.b,n=t.c,s=t.d,r=t.tx,o=t.ty,h=this.vertexData,a=void 0,u=void 0,c=void 0,p=void 0;a=this._bounds.minX,u=this._bounds.maxX,c=this._bounds.minY,p=this._bounds.maxY,h[0]=e*u+n*p+r,h[1]=s*p+i*u+o,h[2]=e*a+n*p+r,h[3]=s*p+i*a+o,h[4]=e*a+n*c+r,h[5]=s*c+i*a+o,h[6]=e*u+n*c+r,h[7]=s*c+i*u+o},z.prototype.calculateBounds=function(){if(this.bounds.clear(),this.visible){this._calculateBounds();for(var t=0;t<this.childs.length;t++){var e=this.childs[t];e.calculateBounds(),this.bounds.addBounds(e.bounds)}}},z.prototype._calculateBounds=function(){this.calculateVertices(),this.bounds.addVert(this.vertexData)},z.prototype.setBounds=function(t){t instanceof D&&(this._bounds=t)},z.prototype.pause=function(){this.paused=!0},z.prototype.restart=function(){this.paused=!1},z.prototype.setSpeed=function(t){this.timeScale=t},(Y.prototype=Object.create(i.prototype)).update=function(t){if(!this.paused&&this.living&&(this.nt+=t,!(this.nt-this.pt<this.interval))){this.pt=this.nt;var e=this.index+this.direction;e<this.frames.length&&e>=0?this.index=e:this.repeats>0||this.infinite?(this.repeats>0&&--this.repeats,this.alternate?(this.direction*=-1,this.index+=this.direction):(this.direction=1,this.index=0)):(this.living=!1,this.index=this.fillMode,this.emit("complete"))}},Y.prototype.getFrame=function(){if(this.index===this.preIndex&&null!==this.preFrame)return this.preFrame;var t=this.element.frame.clone(),e=this.frames[this.index];if(e>0){var i=this.element.naturalWidth/this.element.frame.width>>0,n=this.element.frame.x/this.element.frame.width>>0,s=(n+e)/i>>0,r=(n+e)%i;t.x=r*this.element.frame.width,t.y+=s*this.element.frame.height}return this.preIndex=this.index,this.preFrame=t,t},Y.prototype.playMovie=function(t){this.off("complete");var e=this.format(t.movie);if(it.isArray(e)){if(this.frames=e,this.index=0,this.direction=1,this.fillMode=t.fillMode||0,this.fps=t.fps||this.fps,this.infinite=t.infinite||!1,this.alternate=t.alternate||!1,this.repeats=t.repeats||0,this.living=!0,t.onComplete){var i=this;this.once("complete",function(){t.onComplete.call(i)})}return this}},Y.prototype.format=function(t){if(it.isString(t)){var e=this.animations[t];return e?this.format(e):(console.warn("you havn't config "+t+" in animations "),!1)}if(it.isArray(t))return t;if(it.isObject(t)){for(var i=[],n=t.start;n<=t.end;n++)i.push(n);if(t.next&&this.animations[t.next]){var s=this,r={};it.isString(t.next)&&this.animations[t.next]?(r.movie=t.next,r.infinite=!0):it.isObject(t.next)&&(r=t.next),it.isString(r.movie)&&this.once("complete",function(){s.playMovie(r)})}return i}},Y.prototype.pause=function(){this.paused=!0},Y.prototype.restart=function(){this.paused=!1},Y.prototype.cancle=function(){this.living=!1},Object.defineProperty(Y.prototype,"interval",{get:function(){return this.fps>0?1e3/this.fps>>0:16}}),(j.prototype=Object.create(z.prototype)).upTexture=function(t){var e=this;if(t.texture){if(!t.texture.loaded)return this.ready=!1,void t.texture.on("load",function(){e.upTexture(t),e.ready=!0});this.texture=t.texture,this.naturalWidth=t.texture.naturalWidth,this.naturalHeight=t.texture.naturalHeight,this.frame=t.frame||new T(0,0,this.naturalWidth,this.naturalHeight),this.width=t.width||this.frame.width,this.height=t.height||this.frame.height,this.movieClip&&(this.movieClip.preFrame=null)}},Object.defineProperty(j.prototype,"width",{get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this.updateGeometry())}}),Object.defineProperty(j.prototype,"height",{get:function(){return this._height},set:function(t){this._height!==t&&(this._height=t,this.updateGeometry())}}),j.prototype.updateGeometry=function(){var t=new T(0,0,this.width,this.height);this._bounds.clear().addRect(t),this.setArea(t)},j.prototype.updateAnimation=function(t){this.animation.update(t),this.movieClip.update(t)},j.prototype.playMovie=function(t){return this.movieClip.playMovie(t)},j.prototype.renderMe=function(t){if(this.ready){var e=this.movieClip.getFrame();t.drawImage(this.texture.texture,e.x,e.y,e.width,e.height,0,0,this.width,this.height)}},N.prototype.setSize=function(t){this.width=this.canvas.width=t.width+2*t.px,this.height=this.canvas.height=t.height+2*t.py},N.prototype.clear=function(){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.width,this.height)},N.prototype.setTransform=function(t,e,i,n,s,r){this.ctx.setTransform(t,e,i,n,s,r)},N.prototype.getBuffer=function(){return this.buffer=this.ctx.getImageData(0,0,this.width,this.height),this.buffer},N.prototype.putBuffer=function(){return this.ctx.putImageData(this.buffer,0,0),this.canvas};var gt="fn",wt="in";(V.prototype=Object.create(z.prototype)).renderMe=function(t){this.meshType&&(this.cached||this.cache?(this.cache&&(null===this.frameBuffer&&(this.frameBuffer=new N),this.frameBuffer.clear(),this.__co=this._bounds.getRectangle(),this.__co.px=this.__co.py=0,this.frameBuffer.setSize(this.__co),this.frameBuffer.setTransform(1,0,0,1,-this.__co.x,-this.__co.y),this._drawBack(this.frameBuffer.ctx),this.cached=!0,this.cache=!1),this.frameBuffer&&t.drawImage(this.frameBuffer.canvas,this.__co.x-this.__co.px,this.__co.y-this.__co.py,this.frameBuffer.width,this.frameBuffer.height)):this._drawBack(t))},V.prototype._drawBack=function(t){this.meshType===gt?this.mesh(t):this.meshType===wt&&this.mesh.render(t)},(R.prototype=Object.create(z.prototype)).renderMe=function(t){t.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+" "+this.fontFamily,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,this.fill&&(t.fillStyle=this.fillColor,t.fillText(this.text,0,0)),this.stroke&&(t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeColor,t.strokeText(this.text,0,0))},(U.prototype=Object.create(z.prototype)).updatePosture=function(){this.souldSort&&this._sortList(),this.updateTransform(),this.needUpdateBuffer||this.autoUpdateBuffer?(this.cacheMatrix=this.worldTransform,this.worldTransform=xt.identity(),this._upc(),this.calculateBounds(),this.__o=this.bounds.getRectangle(),this.__o.px=this.padding.x,this.__o.py=this.padding.y,this.worldTransform.translate(-this.__o.x+this.__o.px,-this.__o.y+this.__o.py),this._upc(),this.worldTransform=this.cacheMatrix):this._upc()},U.prototype._upc=function(){for(var t=0,e=this.childs.length;t<e;){this.childs[t].updatePosture(),t++}},U.prototype.addFilter=function(t,e){e>=0?this.filters.splice(e,0,t):it.isUndefined(e)?this.filters.push(t):console.warn("add filter error")},U.prototype.render=function(t){if(t.save(),this.needUpdateBuffer||this.autoUpdateBuffer){var e=0,i=this.childs.length,n=null;for(this.frameBuffer.clear(),this.frameBuffer.setSize(this.__o),e=0;e<i;e++)(n=this.childs[e]).isVisible()&&n.render(this.frameBuffer.ctx);this.filtersRunner(this.frameBuffer.getBuffer()),this.needUpdateBuffer=!1}this.renderMe(t),t.restore()},U.prototype.renderMe=function(t){var e=this.__o.x-this.__o.px,i=this.__o.y-this.__o.py,n=this.frameBuffer.width,s=this.frameBuffer.height;this.setTransform(t),this.mask&&this.mask.render(t),t.drawImage(this.frameBuffer.putBuffer(),0,0,n,s,e,i,n,s)},U.prototype.filtersRunner=function(t){0!==this.filters.length&&this.filters.forEach(function(e){e.applyFilter(t)})};var xt=new F;Object.defineProperty(W.prototype,"blur",{get:function(){return this.blurX},set:function(t){this.blurX=this.blurY=t}});var kt=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265,497,469,443,421,25,191,365,349,335,161,155,149,9,278,269,261,505,245,475,231,449,437,213,415,405,395,193,377,369,361,353,345,169,331,325,319,313,307,301,37,145,285,281,69,271,267,263,259,509,501,493,243,479,118,465,459,113,446,55,435,429,423,209,413,51,403,199,393,97,3,379,375,371,367,363,359,355,351,347,43,85,337,333,165,327,323,5,317,157,311,77,305,303,75,297,294,73,289,287,71,141,279,277,275,68,135,67,133,33,262,260,129,511,507,503,499,495,491,61,121,481,477,237,235,467,232,115,457,227,451,7,445,221,439,218,433,215,427,425,211,419,417,207,411,409,203,202,401,399,396,197,49,389,387,385,383,95,189,47,187,93,185,23,183,91,181,45,179,89,177,11,175,87,173,345,343,341,339,337,21,167,83,331,329,327,163,81,323,321,319,159,79,315,313,39,155,309,307,153,305,303,151,75,299,149,37,295,147,73,291,145,289,287,143,285,71,141,281,35,279,139,69,275,137,273,17,271,135,269,267,133,265,33,263,131,261,130,259,129,257,1],bt=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13,14,14,14,14,10,13,14,14,14,13,13,13,9,14,14,14,15,14,15,14,15,15,14,15,15,15,14,15,15,15,15,15,14,15,15,15,15,15,15,12,14,15,15,13,15,15,15,15,16,16,16,15,16,14,16,16,14,16,13,16,16,16,15,16,13,16,15,16,14,9,16,16,16,16,16,16,16,16,16,13,14,16,16,15,16,16,10,16,15,16,14,16,16,14,16,16,14,16,16,14,15,16,16,16,14,15,14,15,13,16,16,15,17,17,17,17,17,17,14,15,17,17,16,16,17,16,15,17,16,17,11,17,16,17,16,17,16,17,17,16,17,17,16,17,17,16,16,17,17,17,16,14,17,17,17,17,15,16,14,16,15,16,13,16,15,16,14,16,15,16,12,16,15,16,17,17,17,17,17,13,16,15,17,17,17,16,15,17,17,17,16,15,17,17,14,16,17,17,16,17,17,16,15,17,16,14,17,16,15,17,16,17,17,16,17,15,16,17,14,17,16,15,17,16,17,13,17,16,17,17,16,17,14,17,16,17,16,17,16,17,9];W.prototype.applyFilter=function(t){var e=this.blurX>>1;if(isNaN(e)||e<0)return!1;var i=this.blurY>>1;if(isNaN(i)||i<0)return!1;if(0==e&&0==i)return!1;var n=this.quality;(isNaN(n)||n<1)&&(n=1),(n|=0)>3&&(n=3),n<1&&(n=1);var s=t.data,r=0,o=0,h=0,a=0,u=0,c=0,p=0,l=0,f=0,d=0,v=0,y=0,m=0,g=0,w=0,x=e+e+1|0,k=i+i+1|0,b=0|t.width,P=0|t.height,_=b-1|0,O=P-1|0,E=e+1|0,M=i+1|0,T={r:0,b:0,g:0,a:0},D=T;for(h=1;h<x;h++)D=D.n={r:0,b:0,g:0,a:0};D.n=T;var S={r:0,b:0,g:0,a:0},C=S;for(h=1;h<k;h++)C=C.n={r:0,b:0,g:0,a:0};C.n=S;for(var I=null,F=0|kt[e],A=0|bt[e],X=0|kt[i],B=0|bt[i];n-- >0;){p=c=0;var L=F,z=A;for(o=P;--o>-1;){for(l=E*(y=s[0|c]),f=E*(m=s[c+1|0]),d=E*(g=s[c+2|0]),v=E*(w=s[c+3|0]),D=T,h=E;--h>-1;)D.r=y,D.g=m,D.b=g,D.a=w,D=D.n;for(h=1;h<E;h++)a=c+((_<h?_:h)<<2)|0,l+=D.r=s[a],f+=D.g=s[a+1],d+=D.b=s[a+2],v+=D.a=s[a+3],D=D.n;for(I=T,r=0;r<b;r++)s[c++]=l*L>>>z,s[c++]=f*L>>>z,s[c++]=d*L>>>z,s[c++]=v*L>>>z,a=p+((a=r+e+1)<_?a:_)<<2,l-=I.r-(I.r=s[a]),f-=I.g-(I.g=s[a+1]),d-=I.b-(I.b=s[a+2]),v-=I.a-(I.a=s[a+3]),I=I.n;p+=b}for(L=X,z=B,r=0;r<b;r++){for(l=M*(y=s[c=r<<2|0])|0,f=M*(m=s[c+1|0])|0,d=M*(g=s[c+2|0])|0,v=M*(w=s[c+3|0])|0,C=S,h=0;h<M;h++)C.r=y,C.g=m,C.b=g,C.a=w,C=C.n;for(u=b,h=1;h<=i;h++)c=u+r<<2,l+=C.r=s[c],f+=C.g=s[c+1],d+=C.b=s[c+2],v+=C.a=s[c+3],C=C.n,h<O&&(u+=b);if(c=r,I=S,n>0)for(o=0;o<P;o++)s[(a=c<<2)+3]=w=v*L>>>z,w>0?(s[a]=l*L>>>z,s[a+1]=f*L>>>z,s[a+2]=d*L>>>z):s[a]=s[a+1]=s[a+2]=0,a=r+((a=o+M)<O?a:O)*b<<2,l-=I.r-(I.r=s[a]),f-=I.g-(I.g=s[a+1]),d-=I.b-(I.b=s[a+2]),v-=I.a-(I.a=s[a+3]),I=I.n,c+=b;else for(o=0;o<P;o++)s[(a=c<<2)+3]=w=v*L>>>z,w>0?(w=255/w,s[a]=(l*L>>>z)*w,s[a+1]=(f*L>>>z)*w,s[a+2]=(d*L>>>z)*w):s[a]=s[a+1]=s[a+2]=0,a=r+((a=o+M)<O?a:O)*b<<2,l-=I.r-(I.r=s[a]),f-=I.g-(I.g=s[a+1]),d-=I.b-(I.b=s[a+2]),v-=I.a-(I.a=s[a+3]),I=I.n,c+=b}}return!0},(q.prototype=Object.create(z.prototype)).updatePosture=function(t){this.emit("preposture"),this.souldSort&&this._sortList(),this.updateTransform(t);for(var e=0,i=this.childs.length;e<i;)this.childs[e].updatePosture(),e++;this.emit("postposture")};var Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},Ot=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),Et=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},Mt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},Tt=function(){function t(){_t(this,t),this.global=new l(-1e5,-1e5),this.resolution=new l(1,1),this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Ot(t,[{key:"_copyEvent",value:function(t){t.isPrimary&&(this.isPrimary=!0),this.button=t.button,this.buttons=t.buttons,this.width=t.width,this.height=t.height,this.tiltX=t.tiltX,this.tiltY=t.tiltY,this.pointerType=t.pointerType,this.pressure=t.pressure,this.rotationAngle=t.rotationAngle,this.twist=t.twist||0,this.tangentialPressure=t.tangentialPressure||0}},{key:"_reset",value:function(){this.isPrimary=!1}},{key:"pointerId",get:function(){return this.identifier}}]),t}(),Dt=function(){function t(){_t(this,t),this.stopped=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return Ot(t,[{key:"stopPropagation",value:function(){this.stopped=!0}},{key:"_reset",value:function(){this.stopped=!1,this.currentTarget=null,this.target=null}}]),t}(),St=function(){function t(e){_t(this,t),this._pointerId=e,this._flags=t.FLAGS.NONE}return Ot(t,[{key:"_doSet",value:function(t,e){this._flags=e?this._flags|t:this._flags&~t}},{key:"pointerId",get:function(){return this._pointerId}},{key:"flags",get:function(){return this._flags},set:function(t){this._flags=t}},{key:"none",get:function(){return this._flags===this.constructor.FLAGS.NONE}},{key:"over",get:function(){return 0!=(this._flags&this.constructor.FLAGS.OVER)},set:function(t){this._doSet(this.constructor.FLAGS.OVER,t)}},{key:"rightDown",get:function(){return 0!=(this._flags&this.constructor.FLAGS.RIGHT_DOWN)},set:function(t){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,t)}},{key:"leftDown",get:function(){return 0!=(this._flags&this.constructor.FLAGS.LEFT_DOWN)},set:function(t){this._doSet(this.constructor.FLAGS.LEFT_DOWN,t)}}]),t}();St.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4});var Ct="MOUSE",It={target:null,data:{global:null}},Ft=function(t){function e(t,i){_t(this,e);var n=Mt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i=i||{},n.renderer=t,n.autoPreventDefault=i.autoPreventDefault||!1,n.interactionFrequency=i.interactionFrequency||10,n.mouse=new Tt,n.mouse.identifier=Ct,n.mouse.global.set(-999999),n.activeInteractionData={},n.activeInteractionData[Ct]=n.mouse,n.interactionDataPool=[],n.eventData=new Dt,n.interactionDOMElement=null,n.moveWhenInside=!0,n.eventsAdded=!1,n.mouseOverRenderer=!1,n.supportsTouchEvents="ontouchstart"in window,n.supportsPointerEvents=!!window.PointerEvent,n.onClick=n.onClick.bind(n),n.processClick=n.processClick.bind(n),n.onPointerUp=n.onPointerUp.bind(n),n.processPointerUp=n.processPointerUp.bind(n),n.onPointerCancel=n.onPointerCancel.bind(n),n.processPointerCancel=n.processPointerCancel.bind(n),n.onPointerDown=n.onPointerDown.bind(n),n.processPointerDown=n.processPointerDown.bind(n),n.onPointerMove=n.onPointerMove.bind(n),n.processPointerMove=n.processPointerMove.bind(n),n.onPointerOut=n.onPointerOut.bind(n),n.processPointerOverOut=n.processPointerOverOut.bind(n),n.onPointerOver=n.onPointerOver.bind(n),n.cursorStyles={default:"inherit",pointer:"pointer"},n.currentCursorMode=null,n.cursor=null,n._deltaTime=0,n.setTargetElement(n.renderer.canvas),n}return Et(e,i),Ot(e,[{key:"hitTest",value:function(t,e){return It.target=null,It.data.global=t,e||(e=this.renderer),this.processInteractive(It,e,null,!0),It.target}},{key:"setTargetElement",value:function(t){this.removeEvents(),this.interactionDOMElement=t,this.addEvents()}},{key:"addEvents",value:function(){this.interactionDOMElement&&!this.eventsAdded&&(this.emit("addevents"),this.interactionDOMElement.addEventListener("click",this.onClick,!0),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0)}},{key:"removeEvents",value:function(){this.interactionDOMElement&&(this.emit("removeevents"),this.interactionDOMElement.removeEventListener("click",this.onClick,!0),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1)}},{key:"update",value:function(t){var e=t.snippet;if(this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.interactionDOMElement))if(this.didMove)this.didMove=!1;else{this.cursor=null;for(var i in this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(i)){var n=this.activeInteractionData[i];if(n.originalEvent&&"touch"!==n.pointerType){var s=this.configureInteractionEventForDOMEvent(this.eventData,n.originalEvent,n);this.processInteractive(s,this.renderer.currentScene,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}}},{key:"setCursorMode",value:function(t){if(t=t||"default",this.currentCursorMode!==t){this.currentCursorMode=t;var e=this.cursorStyles[t];if(e)switch(void 0===e?"undefined":Pt(e)){case"string":this.interactionDOMElement.style.cursor=e;break;case"function":e(t);break;case"object":Object.assign(this.interactionDOMElement.style,e)}else"string"!=typeof t||Object.prototype.hasOwnProperty.call(this.cursorStyles,t)||(this.interactionDOMElement.style.cursor=t)}}},{key:"triggerEvent",value:function(t,e,i){i.stopped||(i.currentTarget=t,i.type=e,t.emit(e,i),t[e]&&t[e](i))}},{key:"mapPositionToPoint",value:function(t,e,i){var n=t.resolution,s=t.global,r=void 0;r=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,left:0,top:0,width:0,height:0},n.x=this.interactionDOMElement.width/r.width,n.y=this.interactionDOMElement.height/r.height,s.x=(e-r.left)*n.x,s.y=(i-r.top)*n.y}},{key:"processInteractive",value:function(t,e,i,n,s){if(!e||!e.visible)return!1;var r=t.data.global,o=!1,h=s=e.interactive||s;if(e.interactiveChildren&&e.childs)for(var a=e.childs,u=a.length-1;u>=0;u--){var c=a[u],p=this.processInteractive(t,c,i,n,h);if(p){if(!c.parent)continue;h=!1,p&&(t.target&&(n=!1),o=!0)}}return s&&(n&&!t.target&&e.contains(r)&&(o=!0),e.interactive&&(o&&!t.target&&(t.data.target=t.target=e),i&&i(t,e,!!o))),o}},{key:"onClick",value:function(t){if("click"===t.type){var e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&t.preventDefault();var i=this.getInteractionDataForPointerId(e[0]),n=this.configureInteractionEventForDOMEvent(this.eventData,event,i);n.data.originalEvent=t,this.processInteractive(n,this.renderer.currentScene,this.processClick,!0),this.emit("click",n)}}},{key:"processClick",value:function(t,e,i){i&&this.triggerEvent(e,"click",t)}},{key:"onPointerDown",value:function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&t.preventDefault();for(var i=e.length,n=0;n<i;n++){var s=e[n],r=this.getInteractionDataForPointerId(s),o=this.configureInteractionEventForDOMEvent(this.eventData,s,r);if(o.data.originalEvent=t,this.processInteractive(o,this.renderer.currentScene,this.processPointerDown,!0),this.emit("pointerdown",o),"touch"===s.pointerType)this.emit("touchstart",o);else if("mouse"===s.pointerType||"pen"===s.pointerType){var h=2===s.button;this.emit(h?"rightdown":"mousedown",this.eventData)}}}}},{key:"processPointerDown",value:function(t,e,i){var n=t.data,s=t.data.identifier;if(i)if(e.trackedPointers[s]||(e.trackedPointers[s]=new St(s)),this.triggerEvent(e,"pointerdown",t),"touch"===n.pointerType)e.started=!0,this.triggerEvent(e,"touchstart",t);else if("mouse"===n.pointerType||"pen"===n.pointerType){var r=2===n.button;r?e.trackedPointers[s].rightDown=!0:e.trackedPointers[s].leftDown=!0,this.triggerEvent(e,r?"rightdown":"mousedown",t)}}},{key:"onPointerComplete",value:function(t,e,i){for(var n=this.normalizeToPointerData(t),s=n.length,r=t.target!==this.interactionDOMElement?"outside":"",o=0;o<s;o++){var h=n[o],a=this.getInteractionDataForPointerId(h),u=this.configureInteractionEventForDOMEvent(this.eventData,h,a);if(u.data.originalEvent=t,this.processInteractive(u,this.renderer.currentScene,i,e||!r),this.emit(e?"pointercancel":"pointerup"+r,u),"mouse"===h.pointerType||"pen"===h.pointerType){var c=2===h.button;this.emit(c?"rightup"+r:"mouseup"+r,u)}else"touch"===h.pointerType&&(this.emit(e?"touchcancel":"touchend"+r,u),this.releaseInteractionDataForPointerId(h.pointerId,a))}}},{key:"onPointerCancel",value:function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!0,this.processPointerCancel)}},{key:"processPointerCancel",value:function(t,e){var i=t.data,n=t.data.identifier;void 0!==e.trackedPointers[n]&&(delete e.trackedPointers[n],this.triggerEvent(e,"pointercancel",t),"touch"===i.pointerType&&this.triggerEvent(e,"touchcancel",t))}},{key:"onPointerUp",value:function(t){this.supportsTouchEvents&&"touch"===t.pointerType||this.onPointerComplete(t,!1,this.processPointerUp)}},{key:"processPointerUp",value:function(t,e,i){var n=t.data,s=t.data.identifier,r=e.trackedPointers[s],o="touch"===n.pointerType;if("mouse"===n.pointerType||"pen"===n.pointerType){var h=2===n.button,a=St.FLAGS,u=h?a.RIGHT_DOWN:a.LEFT_DOWN,c=void 0!==r&&r.flags&u;i?(this.triggerEvent(e,h?"rightup":"mouseup",t),c&&this.triggerEvent(e,h?"rightclick":"leftclick",t)):c&&this.triggerEvent(e,h?"rightupoutside":"mouseupoutside",t),r&&(h?r.rightDown=!1:r.leftDown=!1)}o&&e.started&&(e.started=!1,this.triggerEvent(e,"touchend",t)),i?(this.triggerEvent(e,"pointerup",t),r&&(this.triggerEvent(e,"pointertap",t),o&&(this.triggerEvent(e,"tap",t),r.over=!1))):r&&(this.triggerEvent(e,"pointerupoutside",t),o&&this.triggerEvent(e,"touchendoutside",t)),r&&r.none&&delete e.trackedPointers[s]}},{key:"onPointerMove",value:function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t);"mouse"===e[0].pointerType&&(this.didMove=!0,this.cursor=null);for(var i=e.length,n=0;n<i;n++){var s=e[n],r=this.getInteractionDataForPointerId(s),o=this.configureInteractionEventForDOMEvent(this.eventData,s,r);o.data.originalEvent=t;var h="touch"!==s.pointerType||this.moveWhenInside;this.processInteractive(o,this.renderer.currentScene,this.processPointerMove,h),this.emit("pointermove",o),"touch"===s.pointerType&&this.emit("touchmove",o),"mouse"!==s.pointerType&&"pen"!==s.pointerType||this.emit("mousemove",o)}"mouse"===e[0].pointerType&&this.setCursorMode(this.cursor)}}},{key:"processPointerMove",value:function(t,e,i){var n=t.data,s="touch"===n.pointerType,r="mouse"===n.pointerType||"pen"===n.pointerType;r&&this.processPointerOverOut(t,e,i),s&&e.started&&this.triggerEvent(e,"touchmove",t),this.moveWhenInside&&!i||(this.triggerEvent(e,"pointermove",t),r&&this.triggerEvent(e,"mousemove",t))}},{key:"onPointerOut",value:function(t){if(!this.supportsTouchEvents||"touch"!==t.pointerType){var e=this.normalizeToPointerData(t)[0];"mouse"===e.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var i=this.getInteractionDataForPointerId(e),n=this.configureInteractionEventForDOMEvent(this.eventData,e,i);n.data.originalEvent=e,this.processInteractive(n,this.renderer.currentScene,this.processPointerOverOut,!1),this.emit("pointerout",n),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",n):this.releaseInteractionDataForPointerId(i.identifier)}}},{key:"processPointerOverOut",value:function(t,e,i){var n=t.data,s=t.data.identifier,r="mouse"===n.pointerType||"pen"===n.pointerType,o=e.trackedPointers[s];i&&!o&&(o=e.trackedPointers[s]=new St(s)),void 0!==o&&(i&&this.mouseOverRenderer?(o.over||(o.over=!0,this.triggerEvent(e,"pointerover",t),r&&this.triggerEvent(e,"mouseover",t)),r&&null===this.cursor&&(this.cursor=e.cursor)):o.over&&(o.over=!1,this.triggerEvent(e,"pointerout",this.eventData),r&&this.triggerEvent(e,"mouseout",t),o.none&&delete e.trackedPointers[s]))}},{key:"onPointerOver",value:function(t){var e=this.normalizeToPointerData(t)[0],i=this.getInteractionDataForPointerId(e),n=this.configureInteractionEventForDOMEvent(this.eventData,e,i);n.data.originalEvent=e,"mouse"===e.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",n),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",n)}},{key:"getInteractionDataForPointerId",value:function(t){var e=t.pointerId,i=void 0;return e===Ct||"mouse"===t.pointerType?i=this.mouse:this.activeInteractionData[e]?i=this.activeInteractionData[e]:((i=this.interactionDataPool.pop()||new Tt).identifier=e,this.activeInteractionData[e]=i),i._copyEvent(t),i}},{key:"releaseInteractionDataForPointerId",value:function(t){var e=this.activeInteractionData[t];e&&(delete this.activeInteractionData[t],e._reset(),this.interactionDataPool.push(e))}},{key:"configureInteractionEventForDOMEvent",value:function(t,e,i){return t.data=i,this.mapPositionToPoint(i,e.clientX,e.clientY),"touch"===e.pointerType&&(e.globalX=i.global.x,e.globalY=i.global.y),i.originalEvent=e,t._reset(),t}},{key:"normalizeToPointerData",value:function(t){var e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var i=0,n=t.changedTouches.length;i<n;i++){var s=t.changedTouches[i];void 0===s.button&&(s.button=t.touches.length?1:0),void 0===s.buttons&&(s.buttons=t.touches.length?1:0),void 0===s.isPrimary&&(s.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===s.width&&(s.width=s.radiusX||1),void 0===s.height&&(s.height=s.radiusY||1),void 0===s.tiltX&&(s.tiltX=0),void 0===s.tiltY&&(s.tiltY=0),void 0===s.pointerType&&(s.pointerType="touch"),void 0===s.pointerId&&(s.pointerId=s.identifier||0),void 0===s.pressure&&(s.pressure=s.force||.5),s.twist=0,s.tangentialPressure=0,void 0===s.layerX&&(s.layerX=s.offsetX=s.clientX),void 0===s.layerY&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,e.push(s)}else!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof window.PointerEvent?e.push(t):(void 0===t.isPrimary&&(t.isPrimary=!0),void 0===t.width&&(t.width=1),void 0===t.height&&(t.height=1),void 0===t.tiltX&&(t.tiltX=0),void 0===t.tiltY&&(t.tiltY=0),void 0===t.pointerType&&(t.pointerType="mouse"),void 0===t.pointerId&&(t.pointerId=Ct),void 0===t.pressure&&(t.pressure=.5),t.twist=0,t.tangentialPressure=0,t.isNormalized=!0,e.push(t));return e}},{key:"destroy",value:function(){this.removeEvents(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this._tempPoint=null}}]),e}();G.prototype.render=function(t,e){this.currentScene=t,this.emit("preupdate",e),this.currentScene.updateTimeline(e),this.currentScene.updatePosture(this.rootMatrix),this.emit("postupdate",e),this.emit("prerender",e),this.autoClear&&(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.width,this.height)),this.currentScene.render(this.ctx),this.emit("postrender",e)},G.prototype.resize=function(t,e){it.isNumber(t)&&it.isNumber(e)?(this.realWidth=t,this.realHeight=e):(t=this.realWidth,e=this.realHeight),this.width=this.canvas.width=t*this.resolution,this.height=this.canvas.height=e*this.resolution},G.prototype.emit=function(){var t;(t=this.interactionManager).emit.apply(t,arguments)},G.prototype.on=function(){var t;(t=this.interactionManager).on.apply(t,arguments)},G.prototype.once=function(){var t;(t=this.interactionManager).once.apply(t,arguments)},G.prototype.off=function(){var t;(t=this.interactionManager).off.apply(t,arguments)},Object.defineProperty(G.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._resolution!==t&&(this._resolution=t,this.rootMatrix.identity().scale(t,t),this.resize())}}),Object.defineProperty(G.prototype,"enableinteractive",{get:function(){return this._enableinteractive},set:function(t){this._enableinteractive!==t&&(this._enableinteractive=t,this.interactiveOnChange())}}),H.prototype.update=function(t){this.renderer.render(this.scene,t)};var At=function(){function t(e,i){_t(this,t),this.layers={},this._forever=!1,this.loader=this.loadAssets(e,i)}return Ot(t,[{key:"loadAssets",value:function(t,e){var i={};return t.filter(function(t){return t.u&&t.p}).forEach(function(t){var n=function(t,e){e&&(e=e.replace(/\/?$/,"/"));var i=t.u+t.p;return t.up||e+i}(t,e);i[t.id]=n}),dt(i)}},{key:"getTexture",value:function(t){return this.loader.getById(t)}},{key:"setLayer",value:function(t,e){t&&(this.layers[t]&&console.warn("动画层命名冲突",t),this.layers[t]=e)}},{key:"forever",value:function(){this._forever||(this._forever=!0)}},{key:"getLayer",value:function(t){return this.layers[t]}}]),t}(),Xt=function(){function t(e,i,n){_t(this,t);var s=i.st,r=void 0===s?0:s;this.inv=e.inv,this.data=n?e.pt:e.ks,this.dynamic=1===this.data.a,this.st=r,this.kic=0,this.dynamic&&this.prepare()}return Ot(t,[{key:"prepare",value:function(){var t=this.data.k,e=t.length-1;this.ost=this.st+t[0].t,this.oet=this.st+t[e].t;for(var i=0;i<e;i++){var n=t[i],s=t[i+1];n.ost=this.st+n.t,n.oet=this.st+s.t,m(n.o.x,n.o.y,n.i.x,n.i.y)}}},{key:"getCurve",value:function(t){return this.dynamic?this.interpolation(t):this.data.k}},{key:"interpolation",value:function(t){var e=this.data.k;if(t<=this.ost)return e[0].s[0];if(t>=this.oet){return e[e.length-2].e[0]}var i={i:[],o:[],v:[]},n=e[this.kic];v(t,n.ost,n.oet)||(this.kic=y(e,t),n=e[this.kic]);var s=(t-n.ost)/(n.oet-n.ost),r=[n.n,n.n],o=n.s[0],h=n.e[0];for(var a in i)if(i[a]){for(var u=o[a],c=h[a],p=[],l=0;l<u.length;l++){var f=u[l],d=c[l];p[l]=g(f,d,r,s)}i[a]=p}return i.c=o.c,i}}]),t}(),Bt=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_t(this,t),this.maskData=e.filter(function(t){return"n"!==t.mode}),this.shapes=this.maskData.map(function(t){return new Xt(t,i,!0)}),this.session=i,this.curves=[]}return Ot(t,[{key:"update",value:function(t){for(var e=0;e<this.shapes.length;e++)this.curves[e]=this.shapes[e].getCurve(t)}},{key:"render",value:function(t){t.beginPath();for(var e=0;e<this.shapes.length;e++)this.shapes[e].inv&&J(t,this.session.size),K(t,this.curves[e]);t.clip()}}]),t}(),Lt=function(){function t(e,i,n){_t(this,t),this.element=e,this.masksProperties=i.masksProperties||[],this.session=n,this.mask=new Bt(this.masksProperties,n),this.element.mask=this.mask}return Ot(t,[{key:"update",value:function(t,e){this.mask.update(t)}}]),t}(),zt=function(t){function e(t,i){_t(this,e);var n=Mt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return n.curve=null,n}return Et(e,Xt),Ot(e,[{key:"update",value:function(t){this.curve=this.getCurve(t)}},{key:"render",value:function(t){K(t,this.curve)}}]),e}(),Yt={o:{props:["alpha"],translate:Z},c:{props:["color"],translate:Q}},jt={o:{props:["alpha"],translate:Z},c:{props:["color"],translate:Q},w:{props:["lineWidth"],translate:tt}},Nt={o:{props:["alpha"],translate:function(t,e){return t[0]/100}},r:{props:["rotation"],translate:function(t,e){return t[0]*Math.PI/180}},p:{props:["x","y"],translate:tt},a:{props:["pivotX","pivotY"],translate:tt},s:{props:["scaleX","scaleY"],translate:function(t,e){return t[e]/100}}},Vt=function(){function t(e,i){_t(this,t);var n=i.st,s=void 0===n?0:n;this.item=e,this.alpha=255,this.color=[0,0,0],this.st=s,this.aks={},this.kic={},this.preParse(e)}return Ot(t,[{key:"preParse",value:function(t){for(var e in Yt)t[e]&&t[e].a?this.parseDynamic(e):t[e]&&this.parseStatic(e)}},{key:"parseDynamic",value:function(t){var e=this.item[t],i=e.k,n=i.length-1;e.ost=this.st+i[0].t,e.oet=this.st+i[n].t;for(var s=0;s<n;s++){var r=i[s],o=i[s+1];r.ost=this.st+r.t,r.oet=this.st+o.t,m(r.o.x,r.o.y,r.i.x,r.i.y)}this.aks[t]=e}},{key:"parseStatic",value:function(t){var e=this.item[t].k;it.isNumber(e)&&(e=[e]),this.setValue(t,e)}},{key:"update",value:function(t,e){for(var i in this.aks)if(this.aks[i]){var n=x(this.aks[i],t,this.kic,i);this.setValue(i,n)}}},{key:"setValue",value:function(t,e){for(var i=Yt[t],n=i.props,s=i.translate,r=0;r<n.length;r++)this[n[r]]=s(e,r)}},{key:"render",value:function(t){t.fillStyle="rgba("+this.color.join(", ")+", "+this.alpha+")"}}]),t}(),Rt=function(){function t(e,i){_t(this,t);var n=i.st,s=void 0===n?0:n;this.item=e,this.alpha=255,this.lineWidth=1,this.color=[0,0,0],this.st=s,this.aks={},this.kic={},this.preParse(e)}return Ot(t,[{key:"preParse",value:function(t){for(var e in jt)t[e]&&t[e].a?this.parseDynamic(e):t[e]&&this.parseStatic(e)}},{key:"parseDynamic",value:function(t){var e=this.item[t],i=e.k,n=i.length-1;e.ost=this.st+i[0].t,e.oet=this.st+i[n].t;for(var s=0;s<n;s++){var r=i[s],o=i[s+1];r.ost=this.st+r.t,r.oet=this.st+o.t,m(r.o.x,r.o.y,r.i.x,r.i.y)}this.aks[t]=e}},{key:"parseStatic",value:function(t){var e=this.item[t].k;it.isNumber(e)&&(e=[e]),this.setValue(t,e)}},{key:"update",value:function(t,e){for(var i in this.aks)if(this.aks[i]){var n=x(this.aks[i],t,this.kic,i);this.setValue(i,n)}}},{key:"setValue",value:function(t,e){for(var i=jt[t],n=i.props,s=i.translate,r=0;r<n.length;r++)this[n[r]]=s(e,r)}},{key:"render",value:function(t){t.strokeStyle="rgba("+this.color.join(", ")+", "+this.alpha+")",t.lineWidth=this.lineWidth}}]),t}(),Ut=/(loopIn|loopOut)\(([^)]+)/,Wt=/["']\w+["']/,qt=function(){function t(e,i,n){_t(this,t),this.begin=i,this.end=n,this.total=this.end-this.begin,this.type=e}return Ot(t,[{key:"update",value:function(t){return"in"===this.type?t>=this.begin?t:this.end-it.euclideanModulo(this.begin-t,this.total):"out"===this.type?t<=this.end?t:this.begin+it.euclideanModulo(t-this.end,this.total):void 0}}]),t}(),Gt=function(){function t(e,i,n){_t(this,t),this.begin=i,this.end=n,this.total=this.end-this.begin,this.type=e}return Ot(t,[{key:"update",value:function(t){if("in"===this.type&&t<this.begin||"out"===this.type&&t>this.end){var e=t-this.end;return this.pingpong(e)}return t}},{key:"pingpong",value:function(t){return Math.floor(t/this.total)%2?this.begin+it.euclideanModulo(t,this.total):this.end-it.euclideanModulo(t,this.total)}}]),t}(),Ht={loopIn:function(t,e,i){var n=t[0].t,s=t[i].t;switch(e){case"cycle":return new qt("in",n,s);case"pingpong":return new Gt("in",n,s)}return null},loopOut:function(t,e,i){var n=t.length-1,s=t[n-i].t,r=t[n].t;switch(e){case"cycle":return new qt("out",s,r);case"pingpong":return new Gt("out",s,r)}return null}},Kt=function(){function t(e,i,n){_t(this,t);var s=n.st,r=void 0===s?0:s,o=n.register;this.element=e,this.ks=i.ks,this.ip=i.ip,this.op=i.op,this.st=r,this.oip=this.st+this.ip,this.oop=this.st+this.op,this.aks={},this.kic={},this.preParse(o)}return Ot(t,[{key:"preParse",value:function(t){var e=this.ks;for(var i in Nt)e[i]&&e[i].a?this.parseDynamic(i,t):e[i]&&this.parseStatic(i)}},{key:"parseDynamic",value:function(t,e){var i=this.ks[t],n=i.k,s=n.length-1;i.ost=this.st+n[0].t,i.oet=this.st+n[s].t;for(var r=0;r<s;r++){var o=n[r],h=n[r+1];if(o.ost=this.st+o.t,o.oet=this.st+h.t,it.isString(o.n)&&o.ti&&o.to){m(o.o.x,o.o.y,o.i.x,o.i.y);var a=new l(o.s[0],o.s[1]),u=new l(o.e[0],o.e[1]),c=new l(o.s[0]+o.ti[0],o.s[1]+o.ti[1]),p=new l(o.e[0]+o.to[0],o.e[1]+o.to[1]);o.curve=new d([a,c,p,u])}else for(var f=0;f<o.n.length;f++)m(o.o.x[f],o.o.y[f],o.i.x[f],o.i.y[f])}(function(t){return Ut.test(t)})(i.x)&&(i.expression=function(t){var e=et(t.x),i=e.name,n=e.mode,s=e.offset,r=0===s?t.k.length-1:s;return Ht[i]&&Ht[i](t.k,n,r)}(i),e.forever()),this.aks[t]=i}},{key:"parseStatic",value:function(t){var e=this.ks[t].k;it.isNumber(e)&&(e=[e]),this.setValue(t,e)}},{key:"update",value:function(t,e){if(e.forever)this.element.visible=t>=this.oip;else{var i=v(t,this.oip,this.oop);if(this.element.visible=i,!i)return}for(var n in this.aks)this.aks[n]&&this.setValue(n,this.interpolation(n,t))}},{key:"interpolation",value:function(t,e){return x(this.aks[t],e,this.kic,t)}},{key:"setValue",value:function(t,e){for(var i=Nt[t],n=i.props,s=i.translate,r=0;r<n.length;r++)this.element[n[r]]=s(e,r)}}]),t}(),Jt=function(t){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_t(this,e);var s=Mt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s.fill=null,s.stroke=null,s.shape=null,s.layer=t,s.itemCache=[],s.parseItems(i.it,n),s}return Et(e,z),Ot(e,[{key:"parseItems",value:function(t,e){for(var i=0;i<t.length;i++){var n=t[i];if("tr"==n.ty){var s=this.layer.ip,r=this.layer.op;this.itemCache.push(new Kt(this,{ks:n,ip:s,op:r},e))}else if("sh"==n.ty||"el"==n.ty||"rc"==n.ty||"sr"==n.ty){var o=$(n,e);if(!o)continue;this.shape=o,this.itemCache.push(this.shape)}else"fl"==t[i].ty?(this.fill=new Vt(n,e),this.itemCache.push(this.fill)):"st"==t[i].ty?(this.stroke=new Rt(n,e),this.itemCache.push(this.stroke)):t[i].ty}}},{key:"update",value:function(t,e){for(var i=0;i<this.itemCache.length;i++)this.itemCache[i].update(t,e)}},{key:"renderMe",value:function(t){this.fill&&this.fill.render(t),this.stroke&&this.stroke.render(t),this.shape&&(t.beginPath(),this.shape.render(t)),this.fill&&t.fill(),this.stroke&&t.stroke()}}]),e}(),$t=function(){function t(e,i,n){_t(this,t),this.element=e,this.shapes=[],this.createShapes(i,n)}return Ot(t,[{key:"createShapes",value:function(t,e){for(var i=t.shapes,n=0;n<i.length;n++){var s=i[n];if("gr"===s.ty){var r=new Jt(t,s,e);this.element.adds(r),this.shapes.push(r)}}}},{key:"update",value:function(t,e){for(var i=0;i<this.shapes.length;i++)this.shapes[i].update(t,e)}}]),t}(),Qt=function(){function t(e,i,n){_t(this,t),this.element=e,this.layer=it.copyJSON(i),this.keyframes=[],this.parse(e,i,n)}return Ot(t,[{key:"parse",value:function(t,e,i){this.transform(t,e,i),e.hasMask&&this.mask(t,e,i),e.shapes&&this.shapes(t,e,i)}},{key:"transform",value:function(t,e,i){this.add(new Kt(t,e,i))}},{key:"mask",value:function(t,e,i){this.add(new Lt(t,e,i))}},{key:"shapes",value:function(t,e,i){this.add(new $t(t,e,i))}},{key:"update",value:function(t,e){for(var i=0;i<this.keyframes.length;i++)this.keyframes[i].update(t,e)}},{key:"add",value:function(t){this.keyframes.push(t)}}]),t}(),Zt=function(t){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_t(this,e);var n=i.parentName,s=i.register,r=s.getTexture(t.refId),o=Mt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,{texture:r}));return o.name=n+"."+t.nm,s.setLayer(o.name,o),o.initKeyFrames(t,i),o}return Et(e,j),Ot(e,[{key:"initKeyFrames",value:function(t,e){this.bodymovin=new Qt(this,t,e),this.movin=!0}},{key:"updateKeyframes",value:function(t,e){this.movin&&this.bodymovin.update(t,e)}}]),e}(),te=function(t){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_t(this,e);var n=Mt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),s=i.parentName,r=i.register;return n.name=s+"."+t.nm,r.setLayer(n.name,n),n.initKeyFrames(t,i),n}return Et(e,z),Ot(e,[{key:"initKeyFrames",value:function(t,e){this.bodymovin=new Qt(this,t,e),this.movin=!0}},{key:"updateKeyframes",value:function(t,e){this.movin&&this.bodymovin.update(t,e)}}]),e}(),ee=function(t){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_t(this,e);var n=Mt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),s=i.assets,r=i.size,o=i.prefix,h=i.register,a=i.parentName,u=0,c=[],p={w:r.w,h:r.h};return it.isArray(t)?(c=t,n.name=a):(n.initKeyFrames(t,i),p.w=t.w,p.h=t.h,c=function(t,e){for(var i=0;i<e.length;i++)if(t===e[i].id)return e[i];return{}}(t.refId,s).layers,u=t.st,a=n.name=a+"."+t.nm),h.setLayer(a,n),n.parseLayers(c,{assets:s,st:u,size:p,prefix:o,register:h,parentName:a}),n}return Et(e,z),Ot(e,[{key:"initKeyFrames",value:function(t,e){this.bodymovin=new Qt(this,t,e),this.movin=!0}},{key:"updateKeyframes",value:function(t,e){this.movin&&this.bodymovin.update(t,e)}},{key:"parseLayers",value:function(t,e){for(var i=this.createElements(t,e),n=t.length-1;n>=0;n--){var s=t[n],r=i[s.ind];if(r)if(s.parent){i[s.parent].adds(r)}else this.adds(r)}}},{key:"createElements",value:function(t,i){for(var n={},s=t.length-1;s>=0;s--){var r=t[s],o=null;switch(r.ty){case 0:o=new e(r,i);break;case 2:o=new Zt(r,i);break;case 4:o=new te(r,i);break;default:continue}o&&(n[r.ind]=o)}return n}}]),e}(),ie=function(){function t(e){var i=this;_t(this,t),this.prefix=e.prefix||e.keyframes.prefix||"",this.keyframes=e.keyframes,this.fr=this.keyframes.fr,this.ip=this.keyframes.ip,this.op=this.keyframes.op,this.tpf=1e3/this.fr,this.tfs=Math.floor(this.op-this.ip),this.living=!0,this.alternate=e.alternate||!1,this.infinite=e.infinite||!1,this.repeats=e.repeats||0,this.delay=e.delay||0,this.wait=e.wait||0,this.duration=this.tfs,this.progress=0,this._pf=-1e4,this.timeScale=it.isNumber(e.timeScale)?e.timeScale:1,this.direction=1,this.repeatsCut=this.repeats,this.delayCut=this.delay,this.waitCut=this.wait,this._paused=!0,this.register=new At(this.keyframes.assets,this.prefix),this.register.loader.once("complete",function(){i._paused=!!it.isBoolean(e.autoStart)&&!e.autoStart}),this.group=new ee(this.keyframes.layers,{assets:this.keyframes.assets,size:{w:this.keyframes.w,h:this.keyframes.h},prefix:this.prefix,register:this.register,parentName:this.keyframes.nm}),this.group._aniRoot=!0,this.updateSession={forever:this.isForever()}}return Ot(t,[{key:"getLayerByName",value:function(t){return this.register.getLayer(t)}},{key:"bindSlot",value:function(t,e){var i=this.getLayerByName(t);i&&i.add(e)}},{key:"emitFrame",value:function(t){this.emit("@"+t)}},{key:"update",value:function(t){if(this.living){var e=this.updateTime(t);this.group.updateMovin(this.progress,this.updateSession);var i=this.progress>>0;this._pf!==i&&(this.emitFrame(this.direction>0?i:this._pf),this._pf=i),!1===e?this.emit("update",this.progress/this.duration):!0===e&&this.emit("complete")}}},{key:"updateTime",value:function(t){var e=this.direction*this.timeScale*t;if(this.waitCut>0)return this.waitCut-=Math.abs(e),null;if(this._paused||this.delayCut>0)return this.delayCut>0&&(this.delayCut-=Math.abs(e)),null;this.progress+=e/this.tpf;var i=!1;return!this.updateSession.forever&&this.spill()&&(this.repeatsCut>0||this.infinite?(this.repeatsCut>0&&--this.repeatsCut,this.delayCut=this.delay,this.alternate?(this.direction*=-1,this.progress=it.codomainBounce(this.progress,0,this.duration)):(this.direction=1,this.progress=it.euclideanModulo(this.progress,this.duration))):(this.progress=it.clamp(this.progress,0,this.duration),i=!0,this.living=!1)),i}},{key:"isForever",value:function(){return this.register._forever}},{key:"spill",value:function(){var t=this.progress<=0&&-1===this.direction,e=this.progress>=this.duration&&1===this.direction;return t||e}},{key:"frameToTime",value:function(t){return t*this.tpf}},{key:"setSpeed",value:function(t){this.timeScale=t}},{key:"pause",value:function(){return this._paused=!0,this}},{key:"resume",value:function(){return this._paused=!1,this}},{key:"play",value:function(){return this._paused=!1,this}},{key:"replay",value:function(){return this._paused=!1,this.living=!0,this.progress=0,this}},{key:"emit",value:function(){var t;(t=this.group).emit.apply(t,arguments)}},{key:"on",value:function(){var t;(t=this.group).on.apply(t,arguments)}},{key:"once",value:function(){var t;(t=this.group).once.apply(t,arguments)}},{key:"off",value:function(){var t;(t=this.group).off.apply(t,arguments)}},{key:"removeAllListeners",value:function(){var t;(t=this.group).removeAllListeners.apply(t,arguments)}}]),t}(),ne=function(){function t(e){var i=this;_t(this,t),this.timeScale=1,this.paused=!1,this.ticker=e||new M,this.groups=[],this.ticker.on("update",function(t){i.update(t)})}return Ot(t,[{key:"add",value:function(t){var e=arguments.length;if(e>1)for(var i=0;i<e;i++)this.add(arguments[i]);else this.groups.push(t);return t}},{key:"parseAnimation",value:function(t){var e=new ie(t);return this.add(e)}},{key:"setSpeed",value:function(t){this.timeScale=t}},{key:"pause",value:function(){return this.paused=!0,this}},{key:"resume",value:function(){return this.paused=!1,this}},{key:"update",value:function(t){if(!this.paused)for(var e=this.timeScale*t,i=this.groups.length,n=0;n<i;n++){this.groups[n].update(e)}}}]),t}();t.Eventer=i,t.Animation=_,t.Tween=ut,t.Utils=it,t.Texture=O,t.Loader=E,t.loaderUtil=dt,t.Ticker=M,t.Bounds=D,t.Point=l,t.Rectangle=T,t.Polygon=S,t.Circle=C,t.Ellipse=I,t.Matrix=F,t.IDENTITY=vt,t.TEMP_MATRIX=yt,t.CatmullRom=A,t.BezierCurve=d,t.SvgCurve=X,t.NURBSCurve=B,t.DisplayObject=L,t.Container=z,t.Sprite=j,t.Graphics=V,t.TextFace=R,t.FilterGroup=U,t.BlurFilter=W,t.FrameBuffer=N,t.Scene=q,t.Renderer=G,t.Application=H,t.AnimationManager=ne,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=jcc2d.min.js.map