
/**
 * jcc2d.js
 * (c) 2014-2017 jason chen
 * Released under the MIT License.
 */

!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.JC=t.JC||{})}(this,function(t){"use strict";function i(t){return Object.prototype.toString.call(t)}function e(){this.listeners={}}function s(t,i,e,s){this.x=t||0,this.y=i||0,this.z=e||0,this.w=s||0}function n(){this.global=new s(-1e5,-1e5),this.target=null,this.originalEvent=null,this.cancleBubble=!1,this.ratio=1,this.type=""}function r(t,i){return 1-3*i+3*t}function o(t,i){return 3*i-6*t}function h(t){return 3*t}function a(t,i,e){return((r(i,e)*t+o(i,e))*t+h(i))*t}function c(t,i,e){return 3*r(i,e)*t*t+2*o(i,e)*t+h(i)}function u(t,i,e,s){if(!(0<=t&&t<=1&&0<=e&&e<=1))throw new Error("bezier x values must be in [0, 1] range");this.mX1=t,this.mY1=i,this.mX2=e,this.mY2=s,this.sampleValues=K?new Float32Array(G):new Array(G),this._preCompute()}function p(t){e.call(this),this.element=t.element||{},this.duration=t.duration||300,this.living=!0,this.resident=t.resident||!1,this.infinite=t.infinite||!1,this.alternate=t.alternate||!1,this.repeats=t.repeats||0,this.delay=t.delay||0,this.wait=t.wait||0,this.timeScale=V.isNumber(t.timeScale)?t.timeScale:1,t.onComplete&&this.on("complete",t.onComplete.bind(this)),t.onUpdate&&this.on("update",t.onUpdate.bind(this)),this.init(),this.paused=!1}function l(t){if(p.call(this,t),!V.isObject(t.from)){t.from={};for(var i in t.to)t.from[i]=this.element[i]}this.ease=t.ease||Q.Ease.InOut,this.from=t.from,this.to=t.to}function f(){}function d(t){p.call(this,t),t.path&&t.path instanceof f||console.warn("path is not instanceof Curve"),this.path=t.path,this.ease=t.ease||Q.Ease.InOut,this.lengthMode=!!V.isBoolean(t.lengthMode)&&t.lengthMode,this.attachTangent=!!V.isBoolean(t.attachTangent)&&t.attachTangent,this._cacheRotate=this.element.rotation;var i=this._cacheRotate*V.DTR;this._cacheVector=new s(10*Math.cos(i),10*Math.sin(i))}function v(t){this.points=t}function m(t,i,e,s,n){var r=n||[e,s,t,i].join("_").replace(/\./g,"p");if(Z[r])return Z[r];var o=new u(t,i,e,s);Z[r]=o}function y(t,i,e){return t>i&&t<=e}function g(t){p.call(this,t),this.keys=t.ks,this.aks={},this.fr=this.keys.fr||30,this.rfr=1e3/this.fr,this.iip=this.keys.ip,this.ip=void 0===t.ip?this.keys.ip:t.ip,this.op=void 0===t.op?this.keys.op:t.op,this.tfs=Math.floor(this.op-this.ip),this.duration=this.tfs*this.rfr,this.keyState={},this.preParser(V.copyJSON(t.ks)),this.nextPose()}function x(t){p.call(this,t),this.runners=t.runners,this.cursor=0,this.queues=[],this.alternate=!1,this.length=this.runners.length}function w(t){this.element=t,this.animates=[],this.timeScale=1,this.paused=!1}function b(t,i){e.call(this),i=i||{};var s=t instanceof Image||"IMG"===t.nodeName;this.type=V.isString(t)?tt:s?it:console.warn("not support asset"),this.crossOrigin=i.crossOrigin,this.texture=null,this.width=0,this.height=0,this.naturalWidth=0,this.naturalHeight=0,this.loaded=!1,this.hadload=!1,this.src=t,this.resole(t),i.lazy&&this.type!==it||this.load(t)}function M(){e.call(this),this.textures={},this._total=0,this._failed=0,this._received=0}function _(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}function S(){e.call(this),this.visible=!0,this.worldAlpha=1,this.alpha=1,this.scaleX=1,this.scaleY=1,this.skewX=0,this.skewY=0,this.rotation=0,this.rotationCache=0,this._sr=0,this._cr=1,this.x=0,this.y=0,this.pivotX=0,this.pivotY=0,this.originX=0,this.originY=0,this.mask=null,this.parent=null,this.worldTransform=new _,this.passEvent=!1,this.eventArea=null,this.Animation=new w(this),this._touchstarted=!1,this._mousedowned=!1,this.buttonMode=!1,this.cursor="pointer"}function T(t,i,e,s){this.x=t||0,this.y=i||0,this.width=e||0,this.height=s||0}function k(t,i,e,s){this.minX=V.isNumber(t)?t:1/0,this.minY=V.isNumber(i)?i:1/0,this.maxX=V.isNumber(e)?e:-1/0,this.maxY=V.isNumber(s)?s:-1/0,this.rect=null}function C(){S.call(this),this.childs=[],this.timeScale=1,this.paused=!1,this._zIndex=0,this.souldSort=!1,this.bounds=new k,this._bounds=new k,this.vertexData=new Float32Array(8)}function P(t,i){e.call(this),this.element=t,this.living=!1,this.infinite=!1,this.alternate=!1,this.repeats=0,this.animations=i.animations||{},this.index=0,this.preIndex=-1,this.direction=1,this.frames=[],this.preFrame=null,this.fillMode=0,this.fps=16,this.paused=!1,this.pt=0,this.nt=0}function B(t){if(C.call(this),this._width=0,this._height=0,this.ready=!0,this.texture=t.texture,this.texture.loaded)this.upTexture(t);else{var i=this;this.ready=!1,this.texture.on("load",function(){i.upTexture(t),i.ready=!0})}this.MovieClip=new P(this,t)}function A(t){this.prefix=t.prefix||"",this.doc=new C,this.fr=t.fr||t.keyframes.fr,this.keyframes=t.keyframes,this.ip=this.keyframes.ip,this.op=this.keyframes.op,this.repeats=t.repeats||0,this.infinite=t.infinite||!1,this.alternate=t.alternate||!1,this.assetBox=null,this.timeline=[],this.preParser(this.keyframes.assets,this.keyframes.layers),this.parser(this.doc,this.keyframes.layers),t.onComplete&&this.timeline[0].on("complete",t.onComplete.bind(this)),t.onUpdate&&this.timeline[0].on("update",t.onUpdate.bind(this))}function O(t){if(!V.isArray(t)){t=new Array(arguments.length);for(var i=0;i<t.length;++i)t[i]=arguments[i]}if(t[0]instanceof s){for(var e=[],n=0,r=t.length;n<r;n++)e.push(t[n].x,t[n].y);t=e}this.closed=!0,this.points=t}function X(t,i,e){this.x=t||0,this.y=i||0,this.radius=e||0}function E(t,i,e,s){this.x=t||0,this.y=i||0,this.width=e||0,this.height=s||0}function F(t){this.points=t,this.passCmp={x:!0,y:!0,z:!1},this.ccmp={},this.updateCcmp()}function Y(t){V.isString(t)?this.path=this.createPath(t):"path"===t.nodeName&&t.getAttribute("d")?this.path=t:console.warn('path just accept <path d="M10 10"> element or "M10 10" string but found '+t),this.totalLength=this.path.getTotalLength()}function I(t,i,e){this.degree=t,this.knots=i,this.controlPoints=e}function z(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}function j(t,i){C.call(this),i=i||{},this.mesh=t,this.meshType=V.isFunction(t)?ot:V.isObject(t)&&V.isFunction(t.render)?ht:"",""===this.meshType&&console.error("不支持的绘制对象"),this.cache=i.cache||!1,this.cached=!1,this.setBounds(i.bounds),this.frameBuffer=null}function D(t,i){C.call(this),this.text=t.toString(),this.fontStyle=i.fontStyle||"normal",this.fontWeight=i.fontWeight||"normal",this.fontSize=i.fontSize||"12px",this.fontFamily=i.fontFamily||"Arial",this.fillColor=i.fillColor||"black",this.strokeColor=i.strokeColor||"red",this.textAlign=i.textAlign||"center",this.textBaseline=i.textBaseline||"middle",this.lineWidth=V.isNumber(i.lineWidth)?i.lineWidth:1,this.stroke=!!V.isBoolean(i.stroke)&&i.stroke,this.fill=!V.isBoolean(i.fill)||i.fill}function L(){C.call(this),this.frameBuffer=new z,this.filters=[],this.needUpdateBuffer=!0,this.autoUpdateBuffer=!1,this.padding={x:0,y:0}}function R(t,i,e){(V.isNumber(t)||t<0)&&(t=0),(V.isNumber(i)||i<0)&&(i=0),(V.isNumber(e)||e<1)&&(e=1),this.blurX=0|t,this.blurY=0|i,this.quality=0|e}function U(t){e.call(this),this.stage=t,this.canvas=this.stage.canvas,this.autoPreventDefault=!0,this.strictMode=!1,this.onMouseUp=this.onMouseUp.bind(this),this.processMouseUp=this.processMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.processMouseMove=this.processMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.processMouseDown=this.processMouseDown.bind(this),this.onClick=this.onClick.bind(this),this.processClick=this.processClick.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.processTouchStart=this.processTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.processTouchEnd=this.processTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.processTouchMove=this.processTouchMove.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.processMouseOverOut=this.processMouseOverOut.bind(this),this.onMouseOver=this.onMouseOver.bind(this),this.defaultCursorStyle="inherit",this.currentCursorStyle="inherit"}function N(t){t=t||{},C.call(this),this.canvas=V.isString(t.dom)?document.getElementById(t.dom)||document.querySelector(t.dom):t.dom,this.realWidth=t.width||this.canvas.width,this.realHeight=t.height||this.canvas.height,this.ctx=this.canvas.getContext("2d"),this.canvas.style.backgroundColor=t.bgColor||"transparent",this.autoClear=!0,this.autoUpdate=!0,this.autoStyle=!1,this.width=this.canvas.width=this.realWidth*this.resolution,this.height=this.canvas.height=this.realHeight*this.resolution,this._resolution=0,this.resolution=t.resolution||1,this.fixedFPS=t.fixedFPS||60,this.pt=null,this.snippet=0,this.averageSnippet=0,this.fps=0,this.averageFps=0,this._takeTime=0,this._renderTimes=0,this.enableFPS=!V.isBoolean(t.enableFPS)||t.enableFPS,this.interactionManager=new U(this),this._interactive=!1,this.interactiveOnChange=function(){this.interactive?this.interactionManager.addEvents():this.interactionManager.removeEvents()},this.interactive=!V.isBoolean(t.interactive)||t.interactive,this.proxyOn()}!function(){for(var t=0,i=["ms","moz","webkit","o"],e=0;e<i.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[i[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[e]+"CancelAnimationFrame"]||window[i[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(i){var e=(new Date).getTime(),s=Math.max(0,16-(e-t)),n=window.setTimeout(function(){i(e+s)},s);return t=e+s,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),window.RAF=window.requestAnimationFrame,window.CAF=window.cancelAnimationFrame}();var V={copyJSON:function(t){return JSON.parse(JSON.stringify(t))},DTR:Math.PI/180,RTD:180/Math.PI,isArray:function(){var t=i([]);return function(e){return i(e)===t}}(),isObject:function(){var t=i({});return function(e){return i(e)===t}}(),isString:function(){var t=i("s");return function(e){return i(e)===t}}(),isNumber:function(){var t=i(1);return function(e){return i(e)===t}}(),isFunction:function(){var t=i(function(){});return function(e){return i(e)===t}}(),isUndefined:function(t){return void 0===t},isBoolean:function(){var t=i(!0);return function(e){return i(e)===t}}(),random:function(t,i){return this.isArray(t)?t[~~(Math.random()*t.length)]:(this.isNumber(i)||(i=t||1,t=0),t+Math.random()*(i-t))},euclideanModulo:function(t,i){return(t%i+i)%i},codomainBounce:function(t,i,e){return t<i?2*i-t:t>e?2*e-t:t},clamp:function(t,i,e){return t<i?i:t>e?e:t},linear:function(t,i,e){return t<=i?0:t>=e?1:t=(t-i)/(e-i)},smoothstep:function(t,i,e){return t<=i?0:t>=e?1:(t=(t-i)/(e-i))*t*(3-2*t)},smootherstep:function(t,i,e){return t<=i?0:t>=e?1:(t=(t-i)/(e-i))*t*t*(t*(6*t-15)+10)}};e.prototype.on=function(t,i){if(V.isFunction(i))return this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(i),this},e.prototype.off=function(t,i){if(!V.isUndefined(this.listeners[t])){var e=this.listeners[t]||[],s=e.length;if(s>0)if(i)for(;s--;)e[s]===i&&e.splice(s,1);else e.length=0;return this}},e.prototype.once=function(t,i){if(V.isFunction(i)){var e=this;return this.on(t,function s(n){i&&i(n),e.off(t,s)}),this}},e.prototype.emit=function(t){if(!V.isUndefined(this.listeners[t])){for(var i=(this.listeners[t]||[]).slice(0),e=[],s=1;s<arguments.length;s++)e.push(arguments[s]);var n=void 0;for(n=0;n<i.length;n++)i[n].apply(this,e)}},s.prototype.clone=function(){return new s(this.x,this.y,this.z,this.w)},s.prototype.copy=function(t){this.set(t.x,t.y,t.z,t.w)},s.prototype.set=function(t,i,e,s){return this.x=t,this.y=i,this.z=e,this.w=s,this},s.prototype.add=function(t,i){return void 0!==i?(console.warn("Use .addVectors( a, b ) instead."),this.addVectors(t,i)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},s.prototype.addVectors=function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},s.prototype.sub=function(t,i){return void 0!==i?(console.warn("Use .subVectors( a, b ) instead."),this.subVectors(t,i)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},s.prototype.subVectors=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},s.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},s.prototype.length=function(){return Math.sqrt(this.lengthSq())},s.prototype.normalize=function(){return this.divideScalar(this.length())},s.prototype.divideScalar=function(t){return this.multiplyScalar(1/t)},s.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},s.prototype.distanceToSquared=function(t){var i=this.x-t.x,e=this.y-t.y,s=this.z-t.z;return i*i+e*e+s*s},s.prototype.multiplyScalar=function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t,this.w*=t):(this.x=0,this.y=0,this.z=0,this.w=0),this},s.prototype.cross=function(t,i){if(void 0!==i)return console.warn("Use .crossVectors( a, b ) instead."),this.crossVectors(t,i);var e=this.x,s=this.y,n=this.z;return this.x=s*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-s*t.x,this},s.prototype.crossVectors=function(t,i){var e=t.x,s=t.y,n=t.z,r=i.x,o=i.y,h=i.z;return this.x=s*h-n*o,this.y=n*r-e*h,this.z=e*o-s*r,this},n.prototype.clone=function(){var t=new n;if(t.originalEvent=this.originalEvent,t.ratio=this.ratio,this.touches){if(t.touches=[],this.touches.length>0){for(var i=0;i<this.touches.length;i++)t.touches[i]={},t.touches[i].global=this.touches[i].global.clone();t.global=t.touches[0].global}}else t.global=this.global.clone();return t};var q=4,W=1e-7,H=10,G=11,J=1/(G-1),K="function"==typeof Float32Array;u.prototype._preCompute=function(){if(this.mX1!==this.mY1||this.mX2!==this.mY2)for(var t=0;t<G;++t)this.sampleValues[t]=a(t*J,this.mX1,this.mX2)},u.prototype._getTForX=function(t){for(var i=0,e=1,s=G-1;e!==s&&this.sampleValues[e]<=t;++e)i+=J;--e;var n=i+(t-this.sampleValues[e])/(this.sampleValues[e+1]-this.sampleValues[e])*J,r=c(n,this.mX1,this.mX2);return r>=.001?function(t,i,e,s){for(var n=0;n<q;++n){var r=c(i,e,s);if(0===r)return i;i-=(a(i,e,s)-t)/r}return i}(t,n,this.mX1,this.mX2):0===r?n:function(t,i,e,s,n){var r=void 0,o=void 0,h=0;do{(r=a(o=i+(e-i)/2,s,n)-t)>0?e=o:i=o}while(Math.abs(r)>W&&++h<H);return o}(t,i,i+J,this.mX1,this.mX2)},u.prototype.get=function(t){return this.mX1===this.mY1&&this.mX2===this.mY2?t:0===t?0:1===t?1:a(this._getTForX(t),this.mY1,this.mY2)};var Q={Linear:{None:function(t){return t}},Ease:{In:function(){var t=new u(.42,0,1,1);return function(i){return t.get(i)}}(),Out:function(){var t=new u(0,0,.58,1);return function(i){return t.get(i)}}(),InOut:function(){var t=new u(.42,0,.58,1);return function(i){return t.get(i)}}(),Bezier:function(t,i,e,s){var n=new u(t,i,e,s);return function(t){return n.get(t)}}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var i=1.70158;return t*t*((i+1)*t-i)},Out:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},InOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)}},Bounce:{In:function(t){return 1-Q.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*Q.Bounce.In(2*t):.5*Q.Bounce.Out(2*t-1)+.5}}};(p.prototype=Object.create(e.prototype)).update=function(t){var i=this.direction*this.timeScale*t;if(this.waitCut>0)this.waitCut-=Math.abs(i);else{if(!(this.paused||!this.living||this.delayCut>0)){this.progress+=i;var e=!1,s=this.progress;this.spill()&&(this.repeatsCut>0||this.infinite?(this.repeatsCut>0&&--this.repeatsCut,this.delayCut=this.delay,this.alternate?(this.direction*=-1,this.progress=V.codomainBounce(this.progress,0,this.duration)):(this.direction=1,this.progress=V.euclideanModulo(this.progress,this.duration))):e=!0);var n=void 0;return e?(this.resident||(this.living=!1),this.progress=V.clamp(s,0,this.duration),n=this.nextPose(),this.emit("complete",n,Math.abs(s-this.progress))):(n=this.nextPose(),this.emit("update",n,this.progress/this.duration)),n}this.delayCut>0&&(this.delayCut-=Math.abs(i))}},p.prototype.spill=function(){var t=this.progress<=0&&-1===this.direction,i=this.progress>=this.duration&&1===this.direction;return t||i},p.prototype.init=function(){this.direction=1,this.progress=0,this.repeatsCut=this.repeats,this.delayCut=this.delay,this.waitCut=this.wait},p.prototype.nextPose=function(){console.warn("should be overwrite")},p.prototype.linear=function(t,i,e){return(i-t)*e+t},p.prototype.pause=function(){this.paused=!0},p.prototype.restart=function(){this.paused=!1},p.prototype.stop=function(){this.repeats=0,this.infinite=!1,this.progress=this.duration},p.prototype.setSpeed=function(t){this.timeScale=t},p.prototype.cancle=function(){this.living=!1},(l.prototype=Object.create(p.prototype)).nextPose=function(){var t={},i=this.ease(this.progress/this.duration);for(var e in this.to)t[e]=this.linear(this.from[e],this.to[e],i),void 0!==this.element[e]&&(this.element[e]=t[e]);return t},f.prototype={constructor:f,getPoint:function(t){return console.warn("Curve: Warning, getPoint() not implemented!",t),null},getPointAt:function(t){var i=this.getUtoTmapping(t);return this.getPoint(i)},getPoints:function(t){isNaN(t)&&(t=5);for(var i=[],e=0;e<=t;e++)i.push(this.getPoint(e/t));return i},getSpacedPoints:function(t){isNaN(t)&&(t=5);for(var i=[],e=0;e<=t;e++)i.push(this.getPointAt(e/t));return i},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(isNaN(t)&&(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var i=[],e=void 0,s=this.getPoint(0),n=void 0,r=0;for(i.push(0),n=1;n<=t;n++)r+=(e=this.getPoint(n/t)).distanceTo(s),i.push(r),s=e;return this.cacheArcLengths=i,i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,i){var e=this.getLengths(),s=0,n=e.length,r=void 0;r=i||t*e[n-1];for(var o=0,h=n-1,a=void 0;o<=h;)if(s=Math.floor(o+(h-o)/2),(a=e[s]-r)<0)o=s+1;else{if(!(a>0)){h=s;break}h=s-1}if(s=h,e[s]===r)return s/(n-1);var c=e[s];return(s+(r-c)/(e[s+1]-c))/(n-1)},getTangent:function(t){var i=t-1e-4,e=t+1e-4,s=this.getPoint(i);return this.getPoint(e).clone().sub(s).normalize()},getTangentAt:function(t){var i=this.getUtoTmapping(t);return this.getTangent(i)}},(d.prototype=Object.create(p.prototype)).nextPose=function(){var t=0,i=this.ease(this.progress/this.duration),e=(this.lengthMode?this.path.getPointAt(i):this.path.getPoint(i)).clone();return this.attachTangent&&(t=this.decomposeRotate(i),e.rotation=!1===t?this.preDegree:t,e.rotation+=this._cacheRotate,!1!==t&&(this.preDegree=t)),this.element.setProps(e),e},d.prototype.decomposeRotate=function(t){var i=this.lengthMode?this.path.getTangentAt(t):this.path.getTangent(t),e=this._cacheVector.x*i.y-i.x*this._cacheVector.y>0?1:-1,s=(i.x*this._cacheVector.x+i.y*this._cacheVector.y)/(Math.sqrt(i.x*i.x+i.y*i.y)*Math.sqrt(this._cacheVector.x*this._cacheVector.x+this._cacheVector.y*this._cacheVector.y));return!isNaN(s)&&e*Math.acos(s)*V.RTD},(v.prototype=Object.create(f.prototype)).getPoint=function(t,i){var e=i||this.points,n=e.length,r=1-t,o=e.slice(0,n-1),h=e.slice(1),a=new s;if(n>3){var c=this.getPoint(t,o),u=this.getPoint(t,h);return a.x=r*c.x+t*u.x,a.y=r*c.y+t*u.y,a}return a.x=r*r*e[0].x+2*t*r*e[1].x+t*t*e[2].x,a.y=r*r*e[0].y+2*t*r*e[1].y+t*t*e[2].y,a};var Z={},$={o:{label:"alpha",scale:.01},r:{label:"rotation",scale:1},p:{label:["x","y"],scale:1},a:{label:["pivotX","pivotY"],scale:1},s:{label:["scaleX","scaleY"],scale:.01}};(g.prototype=Object.create(p.prototype)).preParser=function(t){var i=t.ks;for(var e in i)i[e].a?this.prepareDynamic(i,e):this.prepareStatic(i,e)},g.prototype.prepareDynamic=function(t,i){this.aks[i]=t[i];var e=t[i].k,n=e[e.length-1].t,r=e[0].t;this.aks[i].jcet=n,this.aks[i].jcst=r;for(var o=0;o<e.length;o++){var h=e[o],a=e[o+1];if(a)if(h.jcet=a.t,V.isString(h.n)&&h.ti&&h.to){m(h.o.x,h.o.y,h.i.x,h.i.y);var c=new s(h.s[0],h.s[1]),u=new s(h.e[0],h.e[1]),p=new s(h.ti[0],h.ti[1]),l=new s(h.to[0],h.to[1]),f=new s(h.s[0],h.s[1]),d=new s(h.e[0],h.e[1]);h.curve=new v([c,f.add(p),d.add(l),u])}else for(var y=0;y<h.n.length;y++)m(h.o.x[y],h.o.y[y],h.i.x[y],h.i.y[y])}},g.prototype.prepareStatic=function(t,i){var e=$[i].label,s=$[i].scale,n=0;if(V.isString(e))V.isNumber(t[i].k)&&(n=t[i].k),V.isArray(t[i].k)&&(n=t[i].k[0]),this.element[e]=s*n;else if(V.isArray(e))for(var r=0;r<e.length;r++)n=t[i].k[r],this.element[e[r]]=s*n},g.prototype.nextPose=function(){var t={};for(var i in this.aks){var e=this.aks[i];t[i]=this.interpolation(i,e)}return t},g.prototype.prepare=function(t,i){var e=i.k,s=this.rfr,n=V.clamp(this.progress,0,i.jcet*s),r=i.jcst*s,o=i.jcet*s,h=e.length-2,a=n<this.iip*s;if(a===this.element.visible&&(this.element.visible=!a),n<=r)return e[0].s;if(n>=o)return e[h].e;var c=this.keyState[t];V.isNumber(c)&&y(n,e[c].t*s,e[c].jcet*s)||(c=this.keyState[t]=function(t,i,e){for(var s=t.length-1,n=0;n<s;n++){var r=t[n];if(y(i,r.t*e,r.jcet*e))return n}}(e,n,s));var u=e[c],p=(n/s-u.t)/(u.jcet-u.t);return u.curve?function(t,i,e){var s=Z[i].get(e),n=t.getPointAt(s);return[n.x,n.y,n.z]}(u.curve,u.n,p):function(t,i,e,s){for(var n=[],r=0;r<t.length;r++){var o=Z[e[r]].get(s),h=i[r]-t[r];n[r]=t[r]+h*o}return n}(u.s,u.e,u.n,p)},g.prototype.interpolation=function(t,i){var e=this.prepare(t,i);return this.setValue(t,e),e},g.prototype.setValue=function(t,i){var e=$[t].label,s=$[t].scale;if(V.isString(e))this.element[e]=s*i[0];else if(V.isArray(e))for(var n=0;n<e.length;n++){var r=i[n];this.element[e[n]]=s*r}},(x.prototype=Object.create(p.prototype)).nextRunner=function(t,i){this.queues[this.cursor].init(),this.cursor+=this.direction,this.timeSnippet=i},x.prototype.initRunner=function(){var t=this.runners[this.cursor];t.infinite=!1,t.resident=!0,t.element=this.element;var i=null;t.path?i=new d(t):t.to&&(i=new l(t)),null!==i&&(i.on("complete",this.nextRunner.bind(this)),this.queues.push(i))},x.prototype.nextPose=function(t){return!this.queues[this.cursor]&&this.runners[this.cursor]&&this.initRunner(),this.timeSnippet>=0&&(t+=this.timeSnippet,this.timeSnippet=0),this.queues[this.cursor].update(t)},x.prototype.update=function(t){if(this.wait>0)this.wait-=Math.abs(t);else{if(!(this.paused||!this.living||this.delayCut>0)){var i=this.cursor,e=this.nextPose(this.direction*this.timeScale*t);return this.emit("update",{index:i,pose:e},this.progress/this.duration),this.spill()&&(this.repeats>0||this.infinite?(this.repeats>0&&--this.repeats,this.delayCut=this.delay,this.direction=1,this.cursor=0):(this.resident||(this.living=!1),this.emit("complete",e))),e}this.delayCut>0&&(this.delayCut-=Math.abs(t))}},x.prototype.spill=function(){return this.cursor>=this.length},w.prototype.update=function(t){if(!this.paused){t=this.timeScale*t;for(var i=this.animates.slice(0),e=0;e<i.length;e++)i[e].living||i[e].resident||this.animates.splice(e,1),i[e].update(t)}},w.prototype.animate=function(t,i){return t.element=this.element,this._addMove(new l(t),i)},w.prototype.motion=function(t,i){return t.element=this.element,this._addMove(new d(t),i)},w.prototype.runners=function(t,i){return t.element=this.element,this._addMove(new x(t),i)},w.prototype.keyFrames=function(t,i){return t.element=this.element,this._addMove(new g(t),i)},w.prototype._addMove=function(t,i){return i&&this.clear(),this.animates.push(t),t},w.prototype.pause=function(){this.paused=!0},w.prototype.restart=function(){this.paused=!1},w.prototype.setSpeed=function(t){this.timeScale=t},w.prototype.clear=function(){this.animates.length=0};var tt="url",it="img";(b.prototype=Object.create(e.prototype)).resole=function(t){var i=this;this.type===tt?this.texture=new Image:this.type===it&&(this.texture=t),this.on("load",function(){i.update()})},b.prototype.load=function(t){this.hadload||(this.hadload=!0,t=t||this.src,this.type===tt?this.fromURL(t):this.type===it&&(this.texture.naturalWidth>0&&this.texture.naturalHeight>0?(this.loaded=!0,this.update()):this.fromIMG(t)))},b.prototype.fromURL=function(t){V.isUndefined(this.crossOrigin)||(this.texture.crossOrigin=this.crossOrigin),this.listen(this.texture),this.texture.src=t},b.prototype.fromIMG=function(t){this.listen(t)},b.prototype.listen=function(t){var i=this;t.addEventListener("load",function(){i.loaded=!0,i.emit("load")}),t.addEventListener("error",function(){i.emit("error")})},b.prototype.update=function(){this.width=this.texture.width,this.height=this.texture.height,this.naturalWidth=this.texture.naturalWidth,this.naturalHeight=this.texture.naturalHeight},(M.prototype=Object.create(e.prototype)).load=function(t){var i=this;this._total=0,this._failed=0,this._received=0;for(var e in t)this._total++,this.textures[e]=new b(t[e]),function(t){t.on("load",function(){i._received++,i.emit("update"),i._received+i._failed>=i._total&&i.emit("complete")}),t.on("error",function(){i._failed++,i.emit("update"),i._received+i._failed>=i._total&&i.emit("complete")})}(this.textures[e]);return this},M.prototype.getById=function(t){return this.textures[t]},Object.defineProperty(M.prototype,"progress",{get:function(){return 0===this._total?1:(this._received+this._failed)/this._total}});var et=function(t){return(new M).load(t)};_.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},_.prototype.toArray=function(t){this.array||(this.array=new Float32Array(9));var i=this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},_.prototype.apply=function(t,i){return i=i||{},i.x=this.a*t.x+this.c*t.y+this.tx,i.y=this.b*t.x+this.d*t.y+this.ty,i},_.prototype.applyInverse=function(t,i){var e=1/(this.a*this.d+this.c*-this.b);return i.x=this.d*e*t.x+-this.c*e*t.y+(this.ty*this.c-this.tx*this.d)*e,i.y=this.a*e*t.y+-this.b*e*t.x+(-this.ty*this.a+this.tx*this.b)*e,i},_.prototype.translate=function(t,i){return this.tx+=t,this.ty+=i,this},_.prototype.scale=function(t,i){return this.a*=t,this.d*=i,this.c*=t,this.b*=i,this.tx*=t,this.ty*=i,this},_.prototype.rotate=function(t){var i=Math.cos(t),e=Math.sin(t),s=this.a,n=this.c,r=this.tx;return this.a=s*i-this.b*e,this.b=s*e+this.b*i,this.c=n*i-this.d*e,this.d=n*e+this.d*i,this.tx=r*i-this.ty*e,this.ty=r*e+this.ty*i,this},_.prototype.append=function(t){var i=this.a,e=this.b,s=this.c,n=this.d;return this.a=t.a*i+t.b*s,this.b=t.a*e+t.b*n,this.c=t.c*i+t.d*s,this.d=t.c*e+t.d*n,this.tx=t.tx*i+t.ty*s+this.tx,this.ty=t.tx*e+t.ty*n+this.ty,this},_.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},_.prototype.setTransform=function(t,i,e,s,n,r,o,h,a,c,u){var p=Math.sin(o),l=Math.cos(o),f=Math.tan(a),d=Math.tan(h),v=l*n,m=p*n,y=-p*r,g=l*r,x=e+c,w=s+u;return this.a=v+f*y,this.b=m+f*g,this.c=d*v+y,this.d=d*m+g,this.tx=t-x*this.a-w*this.c+c,this.ty=i-x*this.b-w*this.d+u,this};var st=new _,nt=new _;S.prototype=Object.create(e.prototype),Object.defineProperty(S.prototype,"scale",{get:function(){return this.scaleX},set:function(t){this.scaleX=this.scaleY=t}}),S.prototype.animate=function(t,i){return this.Animation.animate(t,i)},S.prototype.motion=function(t,i){return this.Animation.motion(t,i)},S.prototype.keyFrames=function(t,i){return this.Animation.keyFrames(t,i)},S.prototype.runners=function(t,i){return this.Animation.runners(t,i)},S.prototype.isVisible=function(){return!!(this.visible&&this.alpha>0&&this.scaleX*this.scaleY!=0)},S.prototype.removeMask=function(){this.mask=null},S.prototype.setProps=function(t){if(void 0!==t)for(var i in t)void 0!==this[i]&&(this[i]=t[i])},S.prototype.updateTransform=function(){var t=this.parent&&this.parent.worldTransform||st,i=this.worldTransform,e=this.parent&&this.parent.worldAlpha||1,s=void 0,n=void 0,r=void 0,o=void 0,h=void 0,a=void 0,c=this.pivotX+this.originX,u=this.pivotY+this.originY;this.skewX||this.skewY?(nt.setTransform(this.x,this.y,this.pivotX,this.pivotY,this.scaleX,this.scaleY,this.rotation*V.DTR,this.skewX*V.DTR,this.skewY*V.DTR,this.originX,this.originY),i.a=nt.a*t.a+nt.b*t.c,i.b=nt.a*t.b+nt.b*t.d,i.c=nt.c*t.a+nt.d*t.c,i.d=nt.c*t.b+nt.d*t.d,i.tx=nt.tx*t.a+nt.ty*t.c+t.tx,i.ty=nt.tx*t.b+nt.ty*t.d+t.ty):this.rotation%360?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation*V.DTR),this._cr=Math.cos(this.rotation*V.DTR)),s=this._cr*this.scaleX,n=this._sr*this.scaleX,r=-this._sr*this.scaleY,o=this._cr*this.scaleY,h=this.x,a=this.y,(this.pivotX||this.pivotY||this.originX||this.originY)&&(h-=c*s+u*r-this.originX,a-=c*n+u*o-this.originY),i.a=s*t.a+n*t.c,i.b=s*t.b+n*t.d,i.c=r*t.a+o*t.c,i.d=r*t.b+o*t.d,i.tx=h*t.a+a*t.c+t.tx,i.ty=h*t.b+a*t.d+t.ty):(s=this.scaleX,o=this.scaleY,h=this.x-c*s+this.originX,a=this.y-u*o+this.originY,i.a=s*t.a,i.b=s*t.b,i.c=o*t.c,i.d=o*t.d,i.tx=h*t.a+a*t.c+t.tx,i.ty=h*t.b+a*t.d+t.ty),this.worldAlpha=this.alpha*e},S.prototype.updateAnimation=function(t){this.Animation.update(t)},S.prototype.setTransform=function(t){var i=this.worldTransform;t.globalAlpha=this.worldAlpha,t.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty)},S.prototype.getGlobalPos=function(){return{x:this.worldTransform.tx,y:this.worldTransform.ty}},S.prototype.setArea=function(t,i){null!==this.eventArea&&this.eventArea.clocked&&!i||(this.eventArea=t,i&&(this.eventArea.clocked=!0))},S.prototype.contains=function(t){if(null===this.eventArea)return!1;var i=new s;return this.worldTransform.applyInverse(t,i),this.eventArea&&this.eventArea.contains(i.x,i.y)},T.EMPTY=new T(0,0,0,0),T.prototype.clone=function(){return new T(this.x,this.y,this.width,this.height)},T.prototype.contains=function(t,i){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&i>=this.y&&i<this.y+this.height)},k.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},k.prototype.clear=function(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this},k.prototype.getRectangle=function(t){return this.isEmpty()?T.EMPTY:(t=t||new T(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},k.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},k.prototype.addRect=function(t){this.minX=t.x,this.maxX=t.width+t.x,this.minY=t.y,this.maxY=t.height+t.y},k.prototype.addVert=function(t){for(var i=this.minX,e=this.minY,s=this.maxX,n=this.maxY,r=0;r<t.length;r+=2){var o=t[r],h=t[r+1];i=o<i?o:i,e=h<e?h:e,s=o>s?o:s,n=h>n?h:n}this.minX=i,this.minY=e,this.maxX=s,this.maxY=n},k.prototype.addBounds=function(t){var i=this.minX,e=this.minY,s=this.maxX,n=this.maxY;this.minX=t.minX<i?t.minX:i,this.minY=t.minY<e?t.minY:e,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>n?t.maxY:n},C.prototype=Object.create(S.prototype),Object.defineProperty(C.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.souldSort=!0))}}),C.prototype._sortList=function(){var t=this.childs,i=t.length,e=void 0,s=void 0,n=void 0;for(e=0;e<i-1;e++)for(s=0;s<i-1-e;s++)t[s].zIndex>t[s+1].zIndex&&(n=t[s],t[s]=t[s+1],t[s+1]=n);this.souldSort=!1},C.prototype.adds=function(t){if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.adds(arguments[i]);return this}return t===this&&console.error("adds: object can't be added as a child of itself.",t),t&&t instanceof C?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.childs.push(t),this.souldSort=!0):console.error("adds: object not an instance of Container",t),this},C.prototype.remove=function(t){if(arguments.length>1)for(var i=0;i<arguments.length;i++)this.remove(arguments[i]);var e=this.childs.indexOf(t);-1!==e&&(t.parent=null,this.childs.splice(e,1))},C.prototype.updateTimeline=function(t){if(this.emit("pretimeline",t),!this.paused){t=this.timeScale*t,this.updateAnimation(t);for(var i=0,e=this.childs.length;i<e;){this.childs[i].updateTimeline(t),i++}this.emit("posttimeline",t)}},C.prototype.updatePosture=function(){this.emit("preposture"),this.souldSort&&this._sortList(),this.updateTransform();for(var t=0,i=this.childs.length;t<i;){this.childs[t].updatePosture(),t++}this.emit("postposture")},C.prototype.render=function(t){this.emit("prerender"),t.save(),this.setTransform(t),this.mask&&this.mask.render(t),this.renderMe(t);for(var i=0,e=this.childs.length;i<e;){var s=this.childs[i];i++,s.isVisible()&&s.render(t)}t.restore(),this.emit("postrender")},C.prototype.renderMe=function(){return!0},C.prototype.calculateVertices=function(){var t=this.worldTransform,i=t.a,e=t.b,s=t.c,n=t.d,r=t.tx,o=t.ty,h=this.vertexData,a=void 0,c=void 0,u=void 0,p=void 0;a=this._bounds.minX,c=this._bounds.maxX,u=this._bounds.minY,p=this._bounds.maxY,h[0]=i*c+s*p+r,h[1]=n*p+e*c+o,h[2]=i*a+s*p+r,h[3]=n*p+e*a+o,h[4]=i*a+s*u+r,h[5]=n*u+e*a+o,h[6]=i*c+s*u+r,h[7]=n*u+e*c+o},C.prototype.calculateBounds=function(){if(this.bounds.clear(),this.visible){this._calculateBounds();for(var t=0;t<this.childs.length;t++){var i=this.childs[t];i.calculateBounds(),this.bounds.addBounds(i.bounds)}}},C.prototype._calculateBounds=function(){this.calculateVertices(),this.bounds.addVert(this.vertexData)},C.prototype.setBounds=function(t){t instanceof k&&(this._bounds=t)},C.prototype.pause=function(){this.paused=!0},C.prototype.restart=function(){this.paused=!1},C.prototype.setSpeed=function(t){this.timeScale=t},(P.prototype=Object.create(e.prototype)).update=function(t){if(!this.paused&&this.living&&(this.nt+=t,!(this.nt-this.pt<this.interval))){this.pt=this.nt;var i=this.index+this.direction;i<this.frames.length&&i>=0?this.index=i:this.repeats>0||this.infinite?(this.repeats>0&&--this.repeats,this.alternate?(this.direction*=-1,this.index+=this.direction):(this.direction=1,this.index=0)):(this.living=!1,this.index=this.fillMode,this.emit("complete"))}},P.prototype.getFrame=function(){if(this.index===this.preIndex&&null!==this.preFrame)return this.preFrame;var t=this.element.frame.clone(),i=this.frames[this.index];if(i>0){var e=this.element.naturalWidth/this.element.frame.width>>0,s=this.element.frame.x/this.element.frame.width>>0,n=(s+i)/e>>0,r=(s+i)%e;t.x=r*this.element.frame.width,t.y+=n*this.element.frame.height}return this.preIndex=this.index,this.preFrame=t,t},P.prototype.playMovie=function(t){this.off("complete");var i=this.format(t.movie);if(V.isArray(i)){if(this.frames=i,this.index=0,this.direction=1,this.fillMode=t.fillMode||0,this.fps=t.fps||this.fps,this.infinite=t.infinite||!1,this.alternate=t.alternate||!1,this.repeats=t.repeats||0,this.living=!0,t.onComplete){var e=this;this.once("complete",function(){t.onComplete.call(e)})}return this}},P.prototype.format=function(t){if(V.isString(t)){var i=this.animations[t];return i?this.format(i):(console.warn("you havn't config "+t+" in animations "),!1)}if(V.isArray(t))return t;if(V.isObject(t)){for(var e=[],s=t.start;s<=t.end;s++)e.push(s);if(t.next&&this.animations[t.next]){var n=this,r={};V.isString(t.next)&&this.animations[t.next]?(r.movie=t.next,r.infinite=!0):V.isObject(t.next)&&(r=t.next),V.isString(r.movie)&&this.once("complete",function(){n.playMovie(r)})}return e}},P.prototype.pause=function(){this.paused=!0},P.prototype.restart=function(){this.paused=!1},P.prototype.cancle=function(){this.living=!1},Object.defineProperty(P.prototype,"interval",{get:function(){return this.fps>0?1e3/this.fps>>0:16}}),(B.prototype=Object.create(C.prototype)).upTexture=function(t){this.naturalWidth=t.texture.naturalWidth,this.naturalHeight=t.texture.naturalHeight,this.frame=t.frame||new T(0,0,this.naturalWidth,this.naturalHeight),this.width=t.width||this.frame.width,this.height=t.height||this.frame.height},Object.defineProperty(B.prototype,"width",{get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this.updateGeometry())}}),Object.defineProperty(B.prototype,"height",{get:function(){return this._height},set:function(t){this._height!==t&&(this._height=t,this.updateGeometry())}}),B.prototype.updateGeometry=function(){var t=new T(0,0,this.width,this.height);this._bounds.clear().addRect(t),this.setArea(t)},B.prototype.updateAnimation=function(t){this.Animation.update(t),this.MovieClip.update(t)},B.prototype.playMovie=function(t){return this.MovieClip.playMovie(t)},B.prototype.renderMe=function(t){if(this.ready){var i=this.MovieClip.getFrame();t.drawImage(this.texture.texture,i.x,i.y,i.width,i.height,0,0,this.width,this.height)}},A.prototype.preParser=function(t,i){var e={},s=0,n=i.length;for(s=0;s<t.length;s++){var r=t[s].id,o=t[s].up,h=t[s].u,a=t[s].p;o?e[r]=o:h&&a?e[r]=h+a:t[s].layers||console.error("can not get asset url")}for(s=n-1;s>=0;s--){var c=i[s];this.ip=Math.min(this.ip,c.ip),this.op=Math.max(this.op,c.op)}this.assetBox=et(e)},A.prototype.parser=function(t,i){for(var e=i.length,s=this.repeats,n=this.infinite,r=this.alternate,o=this.ip,h=this.op,a=e-1;a>=0;a--){var c=i[a];if(2===c.ty){var u=this.getAssets(c.refId).id,p=new B({texture:this.assetBox.getById(u)});this.timeline.push(p.keyFrames({ks:c,fr:this.fr,ip:o,op:h,repeats:s,infinite:n,alternate:r})),p.name=c.nm,t.adds(p)}if(0===c.ty){var l=new C,f=this.getAssets(c.refId).layers;this.timeline.push(l.keyFrames({ks:c,fr:this.fr,ip:o,op:h,repeats:s,infinite:n,alternate:r})),l.name=c.nm,t.adds(l),this.parser(l,f)}}},A.prototype.getAssets=function(t){for(var i=this.keyframes.assets,e=0;e<i.length;e++)if(t===i[e].id)return i[e]},A.prototype.setSpeed=function(t){this.doc.setSpeed(t)},A.prototype.pause=function(){this.doc.pause()},A.prototype.restart=function(){this.doc.restart()},A.prototype.stop=function(){this.timeline.forEach(function(t){t.stop()})},A.prototype.cancle=function(){this.timeline.forEach(function(t){t.cancle()})},O.prototype.clone=function(){return new O(this.points.slice())},O.prototype.contains=function(t,i){for(var e=!1,s=this.points.length/2,n=0,r=s-1;n<s;r=n++){var o=this.points[2*n],h=this.points[2*n+1],a=this.points[2*r],c=this.points[2*r+1];h>i!=c>i&&t<(a-o)*(i-h)/(c-h)+o&&(e=!e)}return e},X.prototype.clone=function(){return new X(this.x,this.y,this.radius)},X.prototype.contains=function(t,i){if(this.radius<=0)return!1;var e=this.x-t,s=this.y-i;return e*=e,s*=s,e+s<=this.radius*this.radius},X.prototype.getBounds=function(){return new T(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},E.prototype.clone=function(){return new E(this.x,this.y,this.width,this.height)},E.prototype.contains=function(t,i){if(this.width<=0||this.height<=0)return!1;var e=(t-this.x)/this.width,s=(i-this.y)/this.height;return e*=e,s*=s,e+s<=1},E.prototype.getBounds=function(){return new T(this.x-this.width,this.y-this.height,this.width,this.height)},(F.prototype=Object.create(f.prototype)).updateCcmp=function(){for(var t=0;t<this.points.length;t++){var i=this.points[t];for(var e in this.passCmp)this.passCmp[e]&&!V.isUndefined(i[e])&&(this.ccmp[e]=this.ccmp[e]||[],this.ccmp[e][t]=i[e])}},F.prototype.getPoint=function(t){var i=new s;for(var e in this.passCmp)this.passCmp[e]&&(i[e]=this.solveEachCmp(this.ccmp[e],t));return i},F.prototype.solveEachCmp=function(t,i){var e=t.length-1,s=e*i,n=Math.floor(s),r=this.solve;return t[0]===t[e]?(i<0&&(n=Math.floor(s=e*(1+i))),r(t[(n-1+e)%e],t[n],t[(n+1)%e],t[(n+2)%e],s-n)):i<0?t[0]-(r(t[0],t[0],t[1],t[1],-s)-t[0]):i>1?t[e]-(r(t[e],t[e],t[e-1],t[e-1],s-e)-t[e]):r(t[n?n-1:0],t[n],t[e<n+1?e:n+1],t[e<n+2?e:n+2],s-n)},F.prototype.solve=function(t,i,e,s,n){var r=.5*(e-t),o=.5*(s-i),h=n*n;return(2*i-2*e+r+o)*(n*h)+(-3*i+3*e-2*r-o)*h+r*n+i},(Y.prototype=Object.create(f.prototype)).createPath=function(t){return document.createElementNS("http://www.w3.org/2000/svg","path").setAttribute(t)},Y.prototype.getPoint=function(t){var i=this.path.getPointAtLength(t*this.totalLength);return new s(i.x,i.y)};var rt={findSpan:function(t,i,e){var s=e.length-t-1;if(i>=e[s])return s-1;if(i<=e[t])return t;for(var n=t,r=s,o=Math.floor((n+r)/2);i<e[o]||i>=e[o+1];)i<e[o]?r=o:n=o,o=Math.floor((n+r)/2);return o},calcBasisFunctions:function(t,i,e,s){var n=[],r=[],o=[];n[0]=1;for(var h=1;h<=e;++h){r[h]=i-s[t+1-h],o[h]=s[t+h]-i;for(var a=0,c=0;c<h;++c){var u=o[c+1],p=r[h-c],l=n[c]/(u+p);n[c]=a+u*l,a=p*l}n[h]=a}return n},calcBSplinePoint:function(t,i,e,n){for(var r=this.findSpan(t,n,i),o=this.calcBasisFunctions(r,n,t,i),h=new s(0,0,0,0),a=0;a<=t;++a){var c=e[r-t+a],u=o[a],p=c.w*u;h.x+=c.x*p,h.y+=c.y*p,h.z+=c.z*p,h.w+=c.w*u}return h},calcBasisFunctionDerivatives:function(t,i,e,s,n){var r=[],o=0;for(o=0;o<=e;++o)r[o]=0;var h=[];for(o=0;o<=s;++o)h[o]=r.slice(0);var a=[];for(o=0;o<=e;++o)a[o]=r.slice(0);a[0][0]=1;var c=r.slice(0),u=r.slice(0),p=1,l=0,f=1;for(p=1;p<=e;++p){c[p]=i-n[t+1-p],u[p]=n[t+p]-i;var d=0;for(l=0;l<p;++l){var v=u[l+1],m=c[p-l];a[p][l]=v+m;var y=a[l][p-1]/a[p][l];a[l][p]=d+v*y,d=m*y}a[p][p]=d}for(p=0;p<=e;++p)h[0][p]=a[p][e];for(l=0;l<=e;++l){var g=0,x=1,w=[];for(o=0;o<=e;++o)w[o]=r.slice(0);for(w[0][0]=1,f=1;f<=s;++f){var b=0,M=l-f,_=e-f;l>=f&&(w[x][0]=w[g][0]/a[_+1][M],b=w[x][0]*a[M][_]);var S=l-1<=_?f-1:e-l;for(p=M>=-1?1:-M;p<=S;++p)w[x][p]=(w[g][p]-w[g][p-1])/a[_+1][M+p],b+=w[x][p]*a[M+p][_];l<=_&&(w[x][f]=-w[g][f-1]/a[_+1][l],b+=w[x][f]*a[l][_]),h[f][l]=b,p=g,g=x,x=p}}for(l=e,f=1;f<=s;++f){for(p=0;p<=e;++p)h[f][p]*=l;l*=e-f}return h},calcBSplineDerivatives:function(t,i,e,n,r){for(var o=r<t?r:t,h=[],a=this.findSpan(t,n,i),c=this.calcBasisFunctionDerivatives(a,n,t,o,i),u=[],p=void 0,l=0,f=0;l<e.length;++l){var d=(p=e[l].clone()).w;p.x*=d,p.y*=d,p.z*=d,u[l]=p}for(;f<=o;++f){p=u[a-t].clone().multiplyScalar(c[f][0]);for(var v=1;v<=t;++v)p.add(u[a-t+v].clone().multiplyScalar(c[f][v]));h[f]=p}for(f=o+1;f<=r+1;++f)h[f]=new s(0,0,0);return h},calcKoverI:function(t,i){var e=1,s=2;for(s=2;s<=t;++s)e*=s;var n=1;for(s=2;s<=i;++s)n*=s;for(s=2;s<=t-i;++s)n*=s;return e/n},calcRationalCurveDerivatives:function(t){var i=t.length,e=[],n=[],r=0;for(r=0;r<i;++r){var o=t[r];e[r]=new s(o.x,o.y,o.z),n[r]=o.w}for(var h=[],a=0;a<i;++a){var c=e[a].clone();for(r=1;r<=a;++r)c.sub(h[a-r].clone().multiplyScalar(this.calcKoverI(a,r)*n[r]));h[a]=c.divideScalar(n[0])}return h},calcNURBSDerivatives:function(t,i,e,s,n){var r=this.calcBSplineDerivatives(t,i,e,s,n);return this.calcRationalCurveDerivatives(r)},calcSurfacePoint:function(t,i,e,n,r,o,h){for(var a=this.findSpan(t,o,e),c=this.findSpan(i,h,n),u=this.calcBasisFunctions(a,o,t,e),p=this.calcBasisFunctions(c,h,i,n),l=[],f=0;f<=i;++f){l[f]=new s(0,0,0,0);for(var d=0;d<=t;++d){var v=r[a-t+d][c-i+f].clone(),m=v.w;v.x*=m,v.y*=m,v.z*=m,l[f].add(v.multiplyScalar(u[d]))}}var y=new s(0,0,0,0);for(f=0;f<=i;++f)y.add(l[f].multiplyScalar(p[f]));return y.divideScalar(y.w),new s(y.x,y.y,y.z)}};(I.prototype=Object.create(f.prototype)).constructor=I,I.prototype.getPoint=function(t){var i=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),e=rt.calcBSplinePoint(this.degree,this.knots,this.controlPoints,i);return 1!==e.w&&e.divideScalar(e.w),new s(e.x,e.y,e.z)},I.prototype.getTangent=function(t){var i=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),e=rt.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,i,1)[1].clone();return e.normalize(),e},z.prototype.setSize=function(t){this.width=this.canvas.width=t.width+2*t.px,this.height=this.canvas.height=t.height+2*t.py},z.prototype.clear=function(){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.width,this.height)},z.prototype.setTransform=function(t,i,e,s,n,r){this.ctx.setTransform(t,i,e,s,n,r)},z.prototype.getBuffer=function(){return this.buffer=this.ctx.getImageData(0,0,this.width,this.height),this.buffer},z.prototype.putBuffer=function(){return this.ctx.putImageData(this.buffer,0,0),this.canvas};var ot="fn",ht="in";(j.prototype=Object.create(C.prototype)).renderMe=function(t){this.meshType&&(this.cached||this.cache?(this.cache&&(null===this.frameBuffer&&(this.frameBuffer=new z),this.frameBuffer.clear(),this.__co=this._bounds.getRectangle(),this.__co.px=this.__co.py=0,this.frameBuffer.setSize(this.__co),this.frameBuffer.setTransform(1,0,0,1,-this.__co.x,-this.__co.y),this._drawBack(this.frameBuffer.ctx),this.cached=!0,this.cache=!1),this.frameBuffer&&t.drawImage(this.frameBuffer.canvas,this.__co.x-this.__co.px,this.__co.y-this.__co.py,this.frameBuffer.width,this.frameBuffer.height)):this._drawBack(t))},j.prototype._drawBack=function(t){this.meshType===ot?this.mesh(t):this.meshType===ht&&this.mesh.render(t)},(D.prototype=Object.create(C.prototype)).renderMe=function(t){t.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+" "+this.fontFamily,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,this.fill&&(t.fillStyle=this.fillColor,t.fillText(this.text,0,0)),this.stroke&&(t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeColor,t.strokeText(this.text,0,0))},(L.prototype=Object.create(C.prototype)).updatePosture=function(){this.souldSort&&this._sortList(),this.updateTransform(),this.needUpdateBuffer||this.autoUpdateBuffer?(this.cacheMatrix=this.worldTransform,this.worldTransform=at.identity(),this._upc(),this.calculateBounds(),this.__o=this.bounds.getRectangle(),this.__o.px=this.padding.x,this.__o.py=this.padding.y,this.worldTransform.translate(-this.__o.x+this.__o.px,-this.__o.y+this.__o.py),this._upc(),this.worldTransform=this.cacheMatrix):this._upc()},L.prototype._upc=function(){for(var t=0,i=this.childs.length;t<i;){this.childs[t].updatePosture(),t++}},L.prototype.addFilter=function(t,i){i>=0?this.filters.splice(i,0,t):V.isUndefined(i)?this.filters.push(t):console.warn("add filter error")},L.prototype.render=function(t){if(t.save(),this.needUpdateBuffer||this.autoUpdateBuffer){var i=0,e=this.childs.length,s=null;for(this.frameBuffer.clear(),this.frameBuffer.setSize(this.__o),i=0;i<e;i++)(s=this.childs[i]).isVisible()&&s.render(this.frameBuffer.ctx);this.filtersRunner(this.frameBuffer.getBuffer()),this.needUpdateBuffer=!1}this.renderMe(t),t.restore()},L.prototype.renderMe=function(t){var i=this.__o.x-this.__o.px,e=this.__o.y-this.__o.py,s=this.frameBuffer.width,n=this.frameBuffer.height;this.setTransform(t),this.mask&&this.mask.render(t),t.drawImage(this.frameBuffer.putBuffer(),0,0,s,n,i,e,s,n)},L.prototype.filtersRunner=function(t){0!==this.filters.length&&this.filters.forEach(function(i){i.applyFilter(t)})};var at=new _;Object.defineProperty(R.prototype,"blur",{get:function(){return this.blurX},set:function(t){this.blurX=this.blurY=t}});var ct=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265,497,469,443,421,25,191,365,349,335,161,155,149,9,278,269,261,505,245,475,231,449,437,213,415,405,395,193,377,369,361,353,345,169,331,325,319,313,307,301,37,145,285,281,69,271,267,263,259,509,501,493,243,479,118,465,459,113,446,55,435,429,423,209,413,51,403,199,393,97,3,379,375,371,367,363,359,355,351,347,43,85,337,333,165,327,323,5,317,157,311,77,305,303,75,297,294,73,289,287,71,141,279,277,275,68,135,67,133,33,262,260,129,511,507,503,499,495,491,61,121,481,477,237,235,467,232,115,457,227,451,7,445,221,439,218,433,215,427,425,211,419,417,207,411,409,203,202,401,399,396,197,49,389,387,385,383,95,189,47,187,93,185,23,183,91,181,45,179,89,177,11,175,87,173,345,343,341,339,337,21,167,83,331,329,327,163,81,323,321,319,159,79,315,313,39,155,309,307,153,305,303,151,75,299,149,37,295,147,73,291,145,289,287,143,285,71,141,281,35,279,139,69,275,137,273,17,271,135,269,267,133,265,33,263,131,261,130,259,129,257,1],ut=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13,14,14,14,14,10,13,14,14,14,13,13,13,9,14,14,14,15,14,15,14,15,15,14,15,15,15,14,15,15,15,15,15,14,15,15,15,15,15,15,12,14,15,15,13,15,15,15,15,16,16,16,15,16,14,16,16,14,16,13,16,16,16,15,16,13,16,15,16,14,9,16,16,16,16,16,16,16,16,16,13,14,16,16,15,16,16,10,16,15,16,14,16,16,14,16,16,14,16,16,14,15,16,16,16,14,15,14,15,13,16,16,15,17,17,17,17,17,17,14,15,17,17,16,16,17,16,15,17,16,17,11,17,16,17,16,17,16,17,17,16,17,17,16,17,17,16,16,17,17,17,16,14,17,17,17,17,15,16,14,16,15,16,13,16,15,16,14,16,15,16,12,16,15,16,17,17,17,17,17,13,16,15,17,17,17,16,15,17,17,17,16,15,17,17,14,16,17,17,16,17,17,16,15,17,16,14,17,16,15,17,16,17,17,16,17,15,16,17,14,17,16,15,17,16,17,13,17,16,17,17,16,17,14,17,16,17,16,17,16,17,9];R.prototype.applyFilter=function(t){var i=this.blurX>>1;if(isNaN(i)||i<0)return!1;var e=this.blurY>>1;if(isNaN(e)||e<0)return!1;if(0==i&&0==e)return!1;var s=this.quality;(isNaN(s)||s<1)&&(s=1),(s|=0)>3&&(s=3),s<1&&(s=1);var n=t.data,r=0,o=0,h=0,a=0,c=0,u=0,p=0,l=0,f=0,d=0,v=0,m=0,y=0,g=0,x=0,w=i+i+1|0,b=e+e+1|0,M=0|t.width,_=0|t.height,S=M-1|0,T=_-1|0,k=i+1|0,C=e+1|0,P={r:0,b:0,g:0,a:0},B=P;for(h=1;h<w;h++)B=B.n={r:0,b:0,g:0,a:0};B.n=P;var A={r:0,b:0,g:0,a:0},O=A;for(h=1;h<b;h++)O=O.n={r:0,b:0,g:0,a:0};O.n=A;for(var X=null,E=0|ct[i],F=0|ut[i],Y=0|ct[e],I=0|ut[e];s-- >0;){p=u=0;var z=E,j=F;for(o=_;--o>-1;){for(l=k*(m=n[0|u]),f=k*(y=n[u+1|0]),d=k*(g=n[u+2|0]),v=k*(x=n[u+3|0]),B=P,h=k;--h>-1;)B.r=m,B.g=y,B.b=g,B.a=x,B=B.n;for(h=1;h<k;h++)a=u+((S<h?S:h)<<2)|0,l+=B.r=n[a],f+=B.g=n[a+1],d+=B.b=n[a+2],v+=B.a=n[a+3],B=B.n;for(X=P,r=0;r<M;r++)n[u++]=l*z>>>j,n[u++]=f*z>>>j,n[u++]=d*z>>>j,n[u++]=v*z>>>j,a=p+((a=r+i+1)<S?a:S)<<2,l-=X.r-(X.r=n[a]),f-=X.g-(X.g=n[a+1]),d-=X.b-(X.b=n[a+2]),v-=X.a-(X.a=n[a+3]),X=X.n;p+=M}for(z=Y,j=I,r=0;r<M;r++){for(l=C*(m=n[u=r<<2|0])|0,f=C*(y=n[u+1|0])|0,d=C*(g=n[u+2|0])|0,v=C*(x=n[u+3|0])|0,O=A,h=0;h<C;h++)O.r=m,O.g=y,O.b=g,O.a=x,O=O.n;for(c=M,h=1;h<=e;h++)u=c+r<<2,l+=O.r=n[u],f+=O.g=n[u+1],d+=O.b=n[u+2],v+=O.a=n[u+3],O=O.n,h<T&&(c+=M);if(u=r,X=A,s>0)for(o=0;o<_;o++)n[(a=u<<2)+3]=x=v*z>>>j,x>0?(n[a]=l*z>>>j,n[a+1]=f*z>>>j,n[a+2]=d*z>>>j):n[a]=n[a+1]=n[a+2]=0,a=r+((a=o+C)<T?a:T)*M<<2,l-=X.r-(X.r=n[a]),f-=X.g-(X.g=n[a+1]),d-=X.b-(X.b=n[a+2]),v-=X.a-(X.a=n[a+3]),X=X.n,u+=M;else for(o=0;o<_;o++)n[(a=u<<2)+3]=x=v*z>>>j,x>0?(x=255/x,n[a]=(l*z>>>j)*x,n[a+1]=(f*z>>>j)*x,n[a+2]=(d*z>>>j)*x):n[a]=n[a+1]=n[a+2]=0,a=r+((a=o+C)<T?a:T)*M<<2,l-=X.r-(X.r=n[a]),f-=X.g-(X.g=n[a+1]),d-=X.b-(X.b=n[a+2]),v-=X.a-(X.a=n[a+3]),X=X.n,u+=M}}return!0},(U.prototype=Object.create(e.prototype)).addEvents=function(){this.canvas&&!this.eventsAdded&&(window.document.addEventListener("mousemove",this.onMouseMove,!0),this.canvas.addEventListener("mousedown",this.onMouseDown,!0),this.canvas.addEventListener("click",this.onClick,!0),this.canvas.addEventListener("mouseout",this.onMouseOut,!0),this.canvas.addEventListener("mouseover",this.onMouseOver,!0),this.canvas.addEventListener("touchstart",this.onTouchStart,!0),this.canvas.addEventListener("touchend",this.onTouchEnd,!0),this.canvas.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!0)},U.prototype.removeEvents=function(){this.canvas&&(window.document.removeEventListener("mousemove",this.onMouseMove,!0),this.canvas.removeEventListener("mousedown",this.onMouseDown,!0),this.canvas.removeEventListener("click",this.onClick,!0),this.canvas.removeEventListener("mouseout",this.onMouseOut,!0),this.canvas.removeEventListener("mouseover",this.onMouseOver,!0),this.canvas.removeEventListener("touchstart",this.onTouchStart,!0),this.canvas.removeEventListener("touchend",this.onTouchEnd,!0),this.canvas.removeEventListener("touchmove",this.onTouchMove,!0),window.removeEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!1)},U.prototype.onMouseMove=function(t){var i=this.fixCoord(t);this.cursor=this.defaultCursorStyle,this.processInteractive(this.stage,i,this.processMouseMove,!0),this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.canvas.style.cursor=this.cursor),this.emit("mousemove",i)},U.prototype.processMouseMove=function(t,i,e){this.processMouseOverOut(t,i,e),e&&this.dispatchEvent(t,"mousemove",i)},U.prototype.processMouseOverOut=function(t,i,e){var s=i.clone();e?(t._over||(t._over=!0,this.dispatchEvent(t,"mouseover",s)),t.buttonMode&&(this.cursor=t.cursor)):t._over&&(t._over=!1,this.dispatchEvent(t,"mouseout",s))},U.prototype.onMouseDown=function(t){this.autoPreventDefault&&t.preventDefault();var i=this.fixCoord(t);this.processInteractive(this.stage,i,this.processMouseDown,!0),this.emit("mousedown",i)},U.prototype.processMouseDown=function(t,i,e){e&&this.dispatchEvent(t,i.type,i)},U.prototype.onClick=function(t){this.autoPreventDefault&&t.preventDefault();var i=this.fixCoord(t);this.processInteractive(this.stage,i,this.processClick,!0),this.emit("click",i)},U.prototype.processClick=function(t,i,e){e&&this.dispatchEvent(t,i.type,i)},U.prototype.onMouseUp=function(t){var i=this.fixCoord(t);this.processInteractive(this.stage,i,this.processMouseUp,!0),this.emit("mouseup",i)},U.prototype.processMouseUp=function(t,i,e){e&&this.dispatchEvent(t,i.type,i)},U.prototype.onMouseOut=function(t){var i=this.fixCoord(t);this.processInteractive(this.stage,i,this.processMouseOverOut,!1),this.emit("mouseout",t)},U.prototype.onMouseOver=function(t){this.emit("mouseover",t)},U.prototype.onTouchStart=function(t){var i=this.fixCoord(t);this.processInteractive(this.stage,i,this.processTouchStart,!0),this.emit("touchstart",i)},U.prototype.processTouchStart=function(t,i,e){e&&(t._touchstarted=!0,this.dispatchEvent(t,"touchstart",i))},U.prototype.onTouchEnd=function(t){var i=this.fixCoord(t);this.processInteractive(this.stage,i,this.processTouchEnd,this.strictMode),this.emit("touchend",i)},U.prototype.processTouchEnd=function(t,i){t._touchstarted&&(t._touchstarted=!1,this.dispatchEvent(t,"touchend",i))},U.prototype.onTouchMove=function(t){this.autoPreventDefault&&t.preventDefault();var i=this.fixCoord(t);this.processInteractive(this.stage,i,this.processTouchMove,this.strictMode),this.emit("touchmove",i)},U.prototype.processTouchMove=function(t,i,e){(!this.strictMode&&t._touchstarted||e)&&this.dispatchEvent(t,"touchmove",i)},U.prototype.processInteractive=function(t,i,e,s){function n(t,i,e,s){for(var r=t.childs,o=!1,h=r.length-1;h>=0;){var a=r[h--];o=!1,!a.passEvent&&a.visible&&(a.childs.length>0&&n(a,i,e,s)&&(s=!1,o=!0),s&&!o&&(o=a.contains(i.global))&&(i.target=a,s=!1),e(a,i,o))}return o}n(t,i,e,s)},U.prototype.dispatchEvent=function(t,i,e){if(!e.cancleBubble){e.target||(e.target=t),e.type=i,t.emit(i,e);var s="on"+i;t[s]&&t[s](e)}},U.prototype.fixCoord=function(t){var i=new n,e=this.getPos(this.canvas);if(i.originalEvent=t,i.type=t.type,i.ratio=this.canvas.width/this.canvas.offsetWidth,t.touches){if(i.touches=[],t.touches.length>0){for(var r=0;r<t.touches.length;r++)i.touches[r]={},i.touches[r].global=new s((t.touches[r].pageX-e.x)*i.ratio,(t.touches[r].pageY-e.y)*i.ratio);i.global=i.touches[0].global}}else i.global.x=(t.pageX-e.x)*i.ratio,i.global.y=(t.pageY-e.y)*i.ratio;return i},U.prototype.getPos=function(t){var i=new s;if(t.offsetParent){var e=this.getPos(t.offsetParent);i.x=t.offsetLeft+e.x,i.y=t.offsetTop+e.y}else i.x=t.offsetLeft,i.y=t.offsetTop;return i},(N.prototype=Object.create(C.prototype)).proxyOn=function(){var t=this;["click","mousemove","mousedown","mouseout","mouseover","touchstart","touchend","touchmove","mouseup"].forEach(function(i){t.interactionManager.on(i,function(i){return function(e){t.emit(i,e)}}(i))})},N.prototype.resize=function(t,i,e,s){V.isNumber(t)&&V.isNumber(i)?(this.realWidth=t,this.realHeight=i):(t=this.realWidth,i=this.realHeight),this.width=this.canvas.width=t*this.resolution,this.height=this.canvas.height=i*this.resolution,this.autoStyle&&e&&s&&(this.canvas.style.width=V.isString(e)?e:e+"px",this.canvas.style.height=V.isString(s)?s:s+"px")},N.prototype.render=function(){this.timeline(),this.emit("prerender"),this.autoClear&&(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.width,this.height)),this.updateTimeline(this.snippet),this.updatePosture();for(var t=0,i=this.childs.length;t<i;){var e=this.childs[t];t++,e.isVisible()&&e.render(this.ctx)}this.emit("postrender")},N.prototype.timeline=function(){this.snippet=Date.now()-this.pt,(null===this.pt||this.snippet>200)&&(this.pt=Date.now(),this.snippet=Date.now()-this.pt),this.enableFPS&&(this._renderTimes++,this._takeTime+=Math.max(15,this.snippet),this.fps=1e3/Math.max(15,this.snippet)>>0,this.averageFps=1e3/(this._takeTime/this._renderTimes)>>0),this.pt+=this.snippet},N.prototype.startEngine=function(){this.inRender||(this.inRender=!0,60===this.fixedFPS?this.renderer():this.rendererFixedFPS())},N.prototype.stopEngine=function(){CAF(this.loop),clearInterval(this.loop),this.inRender=!1},N.prototype.renderer=function(){function t(){i.render(),i.loop=RAF(t)}var i=this;t()},N.prototype.rendererFixedFPS=function(){var t=this;this.loop=setInterval(function(){t.render()},1e3/this.fixedFPS),this.render()},Object.defineProperty(N.prototype,"interactive",{get:function(){return this._interactive},set:function(t){this._interactive!==t&&(this._interactive=t,this.interactiveOnChange())}}),Object.defineProperty(N.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._resolution!==t&&(this._resolution=t,this.scale=t,this.resize())}}),t.Eventer=e,t.InteractionData=n,t.Animation=w,t.Tween=Q,t.Utils=V,t.Texture=b,t.Loader=M,t.loaderUtil=et,t.ParserAnimation=A,t.Bounds=k,t.Point=s,t.Rectangle=T,t.Polygon=O,t.Circle=X,t.Ellipse=E,t.Matrix=_,t.IDENTITY=st,t.TEMP_MATRIX=nt,t.CatmullRom=F,t.BezierCurve=v,t.SvgCurve=Y,t.NURBSCurve=I,t.DisplayObject=S,t.Container=C,t.Sprite=B,t.Graphics=j,t.TextFace=D,t.FilterGroup=L,t.BlurFilter=R,t.Stage=N,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=jcc2d.min.js.map